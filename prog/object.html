


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>woo::Object &#8212; Woo 1.0+rev1-git-08c3989 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="../_static/woo-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Conventions" href="conventions.html" />
    <link rel="prev" title="Programming manual" href="index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="conventions.html" title="Conventions"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="Programming manual"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Woo 1.0+rev1-git-08c3989 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Programming manual</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">woo::Object</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="woo-object">
<h1>woo::Object<a class="headerlink" href="#woo-object" title="Permalink to this headline">¶</a></h1>
<p>All objects in Woo derive from the <a class="reference internal" href="../woo.core.html#woo.core.Object" title="woo.core.Object"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.core.Object</span></code></a> (<code class="docutils literal notranslate"><span class="pre">woo::Object</span></code>) class. This base object automatically provides, together with some additional scaffolding described below, basic services:</p>
<ol class="arabic simple">
<li><p>Serialization and deserialization – all objects can be saved and loaded again.</p></li>
<li><p>Information for showing each object in the GUI via attribute traits.</p></li>
<li><p>Exposing c++ classes to Python via boost::python.</p></li>
<li><p>Elegant type-casting and RTTI methods (<code class="docutils literal notranslate"><span class="pre">cast</span></code> and <code class="docutils literal notranslate"><span class="pre">isA</span></code> templates).</p></li>
<li><p>Some introspection capabilities, used mainly for dispatching (class index), and fully available from Python.</p></li>
<li><p>Guarantess that all attributes are initialized (as long as they provide an initialization value</p></li>
</ol>
<section id="woo-decl-and-woo-impl-macro-family">
<h2><code class="docutils literal notranslate"><span class="pre">WOO_DECL__</span></code> and <code class="docutils literal notranslate"><span class="pre">WOO_IMPL__</span></code> macro family<a class="headerlink" href="#woo-decl-and-woo-impl-macro-family" title="Permalink to this headline">¶</a></h2>
<p>The following macros are the standard (and the only supported) way to declare an objects deriving from <code class="docutils literal notranslate"><span class="pre">woo::Object</span></code>. The complexity is a necessary compromise for two contradicting requirements:</p>
<ol class="arabic simple">
<li><p>Have all the important data in one place, for programmer’s convenience. Not half in header and half in implementation file.</p></li>
<li><p>Put only as little data as possible into the header file, so that compilation only <code class="docutils literal notranslate"><span class="pre">#include</span></code>’ing header is not slowed down and takes less RAM (boost::python’s templates are rather memory-hungry).</p></li>
</ol>
<p>Therefore, a macro is defined, which contains all the data necessary, and is passed to <code class="docutils literal notranslate"><span class="pre">WOO_DECL__</span></code> in the header and <code class="docutils literal notranslate"><span class="pre">WOO_IMPL__</span></code> in the implementation file.</p>
<p>The macros is conventionally named as e.g. <code class="docutils literal notranslate"><span class="pre">woo_zoo_Rabbit__...</span></code>, where <code class="docutils literal notranslate"><span class="pre">zoo</span></code> is module (e.g. <code class="docutils literal notranslate"><span class="pre">core</span></code>, <code class="docutils literal notranslate"><span class="pre">dem</span></code> or other). The <code class="docutils literal notranslate"><span class="pre">...</span></code> describe the comma-separated argument types in the macro:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">woo_zoo_Rabbit__CLASS_BASE_DOC</span></code> for class name, base class name, and class docstring (exposed in Python); these three are mandatory, additional fields are added as needed,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">woo_zoo_Rabbit__CLASS_BASE_DOC_ATTRS</span></code> adds attribute specifications (described below)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">woo_zoo_Rabbit__CLASS_BASE_DOC_ATTRS_PY</span></code> adds python initialization block</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">woo_zoo_Rabbit__CLASS_BASE_DOC_ATTRS_CTOR_PY</span></code> allows to insert things into the default constructor (rarely needed)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">woo_zoo_Rabbit__CLASS_BASE_DOC_ATTRS_INI_CTOR_PY</span></code> allows additionally to specify initializers for other variables (seldom needed)</p></li>
</ul>
<p>Note that the arguments must be separated by literal comma (<code class="docutils literal notranslate"><span class="pre">,</span></code>), and no other free commas (not enclosed by parentheses <code class="docutils literal notranslate"><span class="pre">()</span></code>) are allowed (this is a limitation of the C preprocessor).</p>
<p>A simple class declarations may look like this in the hypothetical <code class="docutils literal notranslate"><span class="pre">pkg/zoo/Animal.hpp</span></code> file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nl">Animal</span><span class="p">:</span> <span class="k">public</span> <span class="n">Object</span><span class="p">{</span>
   <span class="cp">#define woo_zoo_Animal__CLASS_BASE_DOC \</span>
<span class="cp">      Animal,Object,&quot;Any animal&quot;</span>
   <span class="n">WOO_DECL__CLASS_BASE_DOC_ATTRS</span><span class="p">(</span><span class="n">woo_zoo_Animal__CLASS_BASE_DOC</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">WOO_REGISTER_OBJECT</span><span class="p">(</span><span class="n">Animal</span><span class="p">);</span> <span class="c1">// must be out of the body</span>

<span class="k">struct</span> <span class="nl">Rabbit</span><span class="p">:</span> <span class="k">public</span> <span class="n">Animal</span><span class="p">{</span>
   <span class="cm">/* macro is defined on multiple lines, joined by trailing backslash */</span>
   <span class="cp">#define woo_zoo_Rabbit__CLASS_BASE_DOC_ATTRS_PY \</span>
<span class="cp">      Rabbit,Animal,&quot;This is a rabbit class, blah blah.&quot;, \</span>
<span class="cp">      ((int,legs,4,,&quot;Number of legs&quot;)) \</span>
<span class="cp">      ((Real,age,0,,&quot;Age of the rabbit&quot;))</span>

  <span class="n">WOO_DECL__CLASS_BASE_DOC_ATTRS_PY</span><span class="p">(</span><span class="n">woo_zoo_Rabbit__CLASS_BASE_DOC_ATTRS_PY</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">WOO_REGISTER_OBJECT</span><span class="p">(</span><span class="n">Rabbit</span><span class="p">);</span>
</pre></div>
</div>
<p>And in the <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="cpf">&lt;woo/pkg/zoo/Animal.hpp&gt;</span><span class="cp"></span>
<span class="c1">// all exported classes; may be used several times in the same file with different modules/classes</span>
<span class="n">WOO_PLUGIN</span><span class="p">(</span><span class="n">zoo</span><span class="p">,(</span><span class="n">Animal</span><span class="p">)(</span><span class="n">Rabbit</span><span class="p">));</span>
<span class="n">WOO_IMPL__CLASS_BASE_DOC_ATTRS</span><span class="p">(</span><span class="n">woo_zoo_Animal__CLASS_BASE_DOC</span><span class="p">);</span>
<span class="n">WOO_IMPL__CLASS_BASE_DOC_ATTRS</span><span class="p">(</span><span class="n">woo_zoo_Rabbit__CLASS_BASE_DOC_ATTRS</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="other-macros">
<h2>Other macros<a class="headerlink" href="#other-macros" title="Permalink to this headline">¶</a></h2>
<p>There are two more macros which <em>must</em> be used with every new class:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">WOO_REGISTER_OBJECT(Rabbit);</span></code> in the header file, after the class declaration and <em>outside</em> of the class body; this is necessary for proper support of <code class="docutils literal notranslate"><span class="pre">boost::serialization</span></code>;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WOO_PLUGIN(zoo,(Animal)(Rabbit));</span></code> in the implementation file; internally, this macro puts the classes to the given module (<code class="docutils literal notranslate"><span class="pre">woo.zoo</span></code> in this example), and completes the serialization support. It may appear more than once in one implementation file (though not with the same classes).</p></li>
</ul>
</section>
<section id="attributes">
<h2>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">ATTR</span></code> part of the <code class="docutils literal notranslate"><span class="pre">WOO_DECL__</span></code> macros is a list of <code class="docutils literal notranslate"><span class="pre">((</span></code> and <code class="docutils literal notranslate"><span class="pre">))</span></code> enclosed 5-tuples describing each attribute (memeber variable, in strict c++ terminology). The components of the tuple are as follows:</p>
<ol class="arabic simple">
<li><p>c++ type of the attribute; it is subject to the following:</p>
<ul class="simple">
<li><p>The type must not contain comma due to macro processing; if you need something like <code class="docutils literal notranslate"><span class="pre">std::map&lt;int,int&gt;</span></code>, use <code class="docutils literal notranslate"><span class="pre">typedef</span></code> inside the class body to declare a shorthand for your type which does not contain one.</p></li>
<li><p>Unless the attribute is declared with <code class="docutils literal notranslate"><span class="pre">Attr::noSave</span></code> (see below), it must be type which <code class="docutils literal notranslate"><span class="pre">boost::serialization</span></code> knows how to serialize. Most useful types (<code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">Real</span></code>, Eigen vectors and matrices, <code class="docutils literal notranslate"><span class="pre">std::vector</span></code>, <code class="docutils literal notranslate"><span class="pre">std::map</span></code>, <code class="docutils literal notranslate"><span class="pre">boost::multiarray</span></code>, <code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code> to anything deriving from <code class="docutils literal notranslate"><span class="pre">woo::Object</span></code>, … are handled just fine)</p></li>
<li><p>The type should have a converter for python (unless declared with <code class="docutils literal notranslate"><span class="pre">Attr::hidden</span></code>, see below); if it does not have converter, compilation will succeed, but accessing the attribute from python will raise <code class="docutils literal notranslate"><span class="pre">TypeError</span></code>.</p></li>
</ul>
</li>
<li><p>Attribute name; must be a valid c++ (and python) identifier. The name is, of course, case-sensitive.</p></li>
<li><p>Default value; if not given (blank), the attribute will be default-initialized. It is strongly recommended to initialize all attributes, to catch any possible problems coming from initialization not being done.</p></li>
<li><p>Attribute traits (discussed below)</p></li>
<li><p>Docstring for the attribute, which will show up in the automatically generated documentation, is also accessible with <code class="docutils literal notranslate"><span class="pre">?</span></code> from IPython prompt, and is shown as tooltip in the UI. Use <a class="reference external" href="http://sphinx-doc.org/rest.html">Sphinx formatting</a>.</p></li>
</ol>
</section>
<section id="attribute-traits">
<h2>Attribute traits<a class="headerlink" href="#attribute-traits" title="Permalink to this headline">¶</a></h2>
<p>Attribute traits is piece of information statically attached in to every attribute; that means, all instances of the attribute share the trait. The trait is defined e.g. in the following way:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AttrTrait</span><span class="o">&lt;</span><span class="n">Attr</span><span class="p">::</span><span class="n">noSave</span><span class="o">|</span><span class="n">Attr</span><span class="p">::</span><span class="n">triggerPostLoad</span><span class="o">&gt;</span><span class="p">()</span><span class="o">.</span><span class="n">noGui</span><span class="p">()</span><span class="o">.</span><span class="n">pyByRef</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">Attr::noSave|Attr::triggerPostLoad</span></code> is template parameter neede for compile-time switches. If there are no flags, the template still must be spelled out, such as in <code class="docutils literal notranslate"><span class="pre">AttrTrait&lt;&gt;().noGui()</span></code>. The trailing methods, which can be chained as they return reference to the attribute trait instance, contain information which is not used until runtime. Traits are fully described by their source in <a class="reference external" href="https://github.com/woodem/woo/tree/master/lib/object/AttrTrait.hpp">lib/object/AttrTrait.hpp</a>. An overview of those which are used the most follows.</p>
<section id="compile-time-flags">
<h3>Compile-time flags<a class="headerlink" href="#compile-time-flags" title="Permalink to this headline">¶</a></h3>
<p>These flags are given as template argument to <cite>AttrTrait&lt;…&gt;()</cite>, combined with the <code class="docutils literal notranslate"><span class="pre">|</span></code> (bit-wise OR) operator if needed.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Attr::noSave</span></code>: the attribute will not be saved, when saving via <code class="docutils literal notranslate"><span class="pre">boost::serialization</span></code>. After loading a saved instance, it will keep the default value. This is useful for types not supported by <code class="docutils literal notranslate"><span class="pre">boost::serialization</span></code> or for saving the amount of data saved if they are redundant and can be reconstructed after the class is loaded.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Attr::triggerPostLoad</span></code>: when the attribute is modified from Python, the <code class="docutils literal notranslate"><span class="pre">postLoad(...)</span></code> function is called, with the address of the member variable passed as the second argument (see <a class="reference internal" href="#woo-object-postload"><span class="std std-ref">woo::Object::postLoad</span></a>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Attr::hidden</span></code>: attribute not exposed to Python at all.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Attr::namedEnum</span></code>: signals that the attribute will be exposed as named enumeration (more on that below); this must be complemented by <code class="docutils literal notranslate"><span class="pre">.namedEnum(...)</span></code> specified on the trait, defining which are the admissible values and their names.</p></li>
</ul>
</section>
<section id="runtime-traits">
<h3>Runtime traits<a class="headerlink" href="#runtime-traits" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.noDump()</span></code>: do not dump this attribute when serializing to formats without <code class="docutils literal notranslate"><span class="pre">boost::serialization</span></code> formats, such as JSON, Python expression, Pickle, HTML and others. Useful to avoid large nested structures inflating those representations with useless data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.pyByRef()</span></code>: expose the attribute by reference to Python. The default is to expose by-value, with the exception of <code class="docutils literal notranslate"><span class="pre">Eigen</span></code>’s matrices and vectors (see <code class="docutils literal notranslate"><span class="pre">py_wrap_ref</span></code> template in <a class="reference external" href="https://github.com/woodem/woo/tree/master/lib/object/Object.hpp">lib/object/Object.hpp</a>). <code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code> exposed by-value in reality exposes reference to the object. This attribute is only rarely useful.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.readonly()</span></code>: the attribute is no writable from python; this includes passing the value to the constructor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.namedEnum({{1,{&quot;one&quot;,&quot;eins&quot;,&quot;just</span> <span class="pre">one&quot;}},{0,{&quot;zero&quot;,&quot;null&quot;,&quot;nothing&quot;}}})</span></code>: in conjunction with the <code class="docutils literal notranslate"><span class="pre">Attr::namedEnum</span></code> flag described above, define string aliases for integral values, using initializer list. The first string is the preferred name (always returned) while the other ones are aliases, which can be also used. Assigning the integral value is still possible.</p></li>
</ul>
<p>THe following traits influence how is the attribute displayed in the GUI:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.noGui()</span></code>: do not show this attribute in the GUI, even though it is exposed to Python.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.rgbColor()</span></code>: used for <code class="docutils literal notranslate"><span class="pre">Vector3r</span></code> attributes with the meaning of color; color picker icon will be displayed in the UI, for picking color visually.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.filename()</span></code>, <code class="docutils literal notranslate"><span class="pre">.existingFilename()</span></code>, <code class="docutils literal notranslate"><span class="pre">.dirname()</span></code>: in the UI, show picker for (possibly non-existing) filename, existing filename, and directory, respectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.angleUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.timeUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.lenUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.areaUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.volUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.velUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.accelUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.massUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.angVelUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.angMomUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.inertiaUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.forceUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.torqueUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.pressureUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.stiffnessUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.massRateUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.densityUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.fractionUnit()</span></code>, <code class="docutils literal notranslate"><span class="pre">.surfEnergyUnit()</span></code>: self-explanatory unit specification for given attribute. The value is <strong>always internally stored in base unit</strong> (usually the SI), but the UI may scale the quantity and present it in a readable way. The units are accessible from the <code class="docutils literal notranslate"><span class="pre">woo.unit</span></code> dicionary, e.g. as <code class="docutils literal notranslate"><span class="pre">woo.unit['t/h']</span></code>, which contains the multiplier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.multiUnit()</span></code>: for 2d arrays (such as list of <code class="docutils literal notranslate"><span class="pre">Vector2r</span></code>), use different units for every column; this must be followed by unit traits; e.g. PSD points declared as <code class="docutils literal notranslate"><span class="pre">vector&lt;Vector2r&gt;</span></code> may say <code class="docutils literal notranslate"><span class="pre">.multiUnit().lenUnit().fractionUnit()</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.range(Vector2i(a,b))</span></code>, <code class="docutils literal notranslate"><span class="pre">.range(Vector2r(a,b))</span></code>: show UI slider for integral/float values between <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.choice({1,2,3})</span></code>: UI choice from integral values</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.bits({&quot;bit</span> <span class="pre">0&quot;,&quot;bit</span> <span class="pre">1&quot;})</span></code>: create checkboxes for individual bits of an integer attribute (starting from the least significant, i.e. the rightmost bit)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.hideIf(&quot;self.foo=='bar'&quot;)</span></code>: the attribute will be dynamically hidden from the UI if the expression given evaluates to <code class="docutils literal notranslate"><span class="pre">True</span></code>; <code class="docutils literal notranslate"><span class="pre">self</span></code> is the current instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.startGroup(&quot;Name&quot;)</span></code>: start attribute group named <code class="docutils literal notranslate"><span class="pre">Name</span></code>, shown as collapsible group of attributes, and also shown in the documentation as an attribute group.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.buttons({&quot;button</span> <span class="pre">label&quot;,&quot;python</span> <span class="pre">command</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">executed&quot;,&quot;label&quot;,...})</span></code>: create button(s) in the UI, where each triplet specifies one button; it will be created after the attribute itself by default, which can be changed by setting the second optional argument <code class="docutils literal notranslate"><span class="pre">showBefore</span></code> to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></li>
</ul>
</section>
</section>
<section id="serialization-support">
<h2>Serialization support<a class="headerlink" href="#serialization-support" title="Permalink to this headline">¶</a></h2>
<p>Every Woo object declared with the <code class="docutils literal notranslate"><span class="pre">WOO_DECL__</span></code> and <code class="docutils literal notranslate"><span class="pre">WOO_IMPL__</span></code> macros introduced above automatically has the ability to be serialized and deserialized (saved and loaded). C++ objects are natively (fully) supported by <a class="reference external" href="http://www.boost.org/doc/libs/release/libs/serialization/">boost::serialization</a>, with the ability to save to binary and XML formats, including optional compression using gzip or bzip2. The serialization routines are implemented in <a class="reference external" href="https://github.com/woodem/woo/tree/master/lib/object/ObjectIO.hpp">lib/object/ObjectIO.hpp</a>. <code class="docutils literal notranslate"><span class="pre">boost::serialization</span></code> takes care of object tracking (when several objects point to another object via <code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code>, it is saved only once, and the pointers are correctly updated when deserialized) and many other tricky aspects of serialization. Most attribute types are supported for serialization, including <code class="docutils literal notranslate"><span class="pre">shared_ptr</span></code> to any <code class="docutils literal notranslate"><span class="pre">woo::Object</span></code> or its subclasses, <code class="docutils literal notranslate"><span class="pre">Eigen::Matrix</span></code> (any subclasses), primitive datatypes (numbers, strings), STL containers (<code class="docutils literal notranslate"><span class="pre">std::vector</span></code>, <code class="docutils literal notranslate"><span class="pre">std::list</span></code>, <code class="docutils literal notranslate"><span class="pre">std::map</span></code> of any of the above), <code class="docutils literal notranslate"><span class="pre">boost::python::object</span></code> (internally using the <a class="reference external" href="https://docs.python.org/2/library/pickle.html">cPickle</a> module) and so on.</p>
<p>When loading (deserializing), <code class="docutils literal notranslate"><span class="pre">boost::serialization</span></code> default-constucts the type, then sets it attributes. For this reason, all Woo objects must be default-constructible. This is taken care of by the <code class="docutils literal notranslate"><span class="pre">woo::Object</span></code> macros.</p>
<p>C++ objects can also be (de)serialized using Python, in which case not all information is stored. The documentation refers to this process as dumping (rather than serializing), where the formats supported are python expression (evaluating to the object, when read back), HTML dump, JSON. These are meant for post-processing rather than storing and reloading bigger objects at once.</p>
<p>There are four methods called around (de)serialization, if defined (they are found via ADL; that’s why the first argument is reference to the current instance, which is no really useful in the code)</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">preSave(Rabbit&amp;)</span></code>, before saving an object; useful for converting internal data not handled by boost::serialization into some better format suitable for saving, or otherwise preparing the object for serialization; seldom used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">postSave(Rabbit&amp;)</span></code>, after saving an object; seldom used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">preLoad(Rabbit&amp;)</span></code>, before loading an object; seldom used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">postLoad(Rabbit&amp;,void*</span> <span class="pre">attr=NULL)</span></code>, after loading an object. The <code class="docutils literal notranslate"><span class="pre">attr</span></code> pointer is <code class="docutils literal notranslate"><span class="pre">NULL</span></code> when called after  deserialization (other cases are discussed below).</p></li>
</ol>
<section id="woo-object-postload">
<span id="id1"></span><h3>woo::Object::postLoad<a class="headerlink" href="#woo-object-postload" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">postLoad</span></code> function serves two purposes, depending on the value of the second <code class="docutils literal notranslate"><span class="pre">void*</span> <span class="pre">attr</span></code> argument:</p>
<ol class="arabic simple">
<li><p>with <code class="docutils literal notranslate"><span class="pre">attr==NULL</span></code>, the object is asked to get set up after having been deserialized.</p></li>
<li><p>with <code class="docutils literal notranslate"><span class="pre">attr!=NULL</span></code>, the pointer hold address of an attribute which has been changed from Python (if it was declared with <code class="docutils literal notranslate"><span class="pre">Attr::triggerPostLoad</span></code>) and can react accordingly, e.g.</p>
<ul class="simple">
<li><p>update dependent attributes: for instance, <a class="reference internal" href="../woo.dem.html#woo.dem.ConveyorInlet" title="woo.dem.ConveyorInlet"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.dem.ConveyorInlet</span></code></a> handles a number of inter-dependent options, such as <a class="reference internal" href="../woo.dem.html#woo.dem.ConveyorInlet.vel" title="woo.dem.ConveyorInlet.vel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">vel</span></code></a>, <a class="reference internal" href="../woo.dem.html#woo.dem.ConveyorInlet.massRate" title="woo.dem.ConveyorInlet.massRate"><code class="xref py py-obj docutils literal notranslate"><span class="pre">massRate</span></code></a> and others; when one of them is set, the other ones are recomputed to be consistent;</p></li>
<li><p>values can be checked for validity; if invalid, exception is thrown from <code class="docutils literal notranslate"><span class="pre">postLoad</span></code>, letting the user know about invalid value immediately;</p></li>
<li><p>unit vector attributes can be automatically normalized in <code class="docutils literal notranslate"><span class="pre">postLoad</span></code> when set.</p></li>
</ul>
</li>
</ol>
</section>
</section>
<section id="casting">
<h2>Casting<a class="headerlink" href="#casting" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">woo::Object</span></code> defines two utility methods for casting:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">object-&gt;isA&lt;Type&gt;()</span></code> dynamically checks type of <code class="docutils literal notranslate"><span class="pre">object</span></code>, such as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">shape</span><span class="o">-&gt;</span><span class="n">isA</span><span class="o">&lt;</span><span class="n">Sphere</span><span class="o">&gt;</span><span class="p">())</span> <span class="o">/*</span> <span class="o">...</span> <span class="o">*/</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">object-&gt;cast&lt;Type&gt;()</span></code> statically casts <code class="docutils literal notranslate"><span class="pre">object</span></code> to <code class="docutils literal notranslate"><span class="pre">Type</span></code>; if the cast is invalid, the behavior is undefined (most likely a crash), this has to be assured by context or by <code class="docutils literal notranslate"><span class="pre">isA</span></code> check before:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>if(shape-&gt;isA&lt;Sphere&gt;()) radius=shape-&gt;cast&lt;Sphere&gt;().radius``.
</pre></div>
</div>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Report issues or inclarities to <a class="reference external" href="https://github.com/woodem/woo/issues">github</a>.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../contents.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">woo::Object</a><ul>
<li><a class="reference internal" href="#woo-decl-and-woo-impl-macro-family"><code class="docutils literal notranslate"><span class="pre">WOO_DECL__</span></code> and <code class="docutils literal notranslate"><span class="pre">WOO_IMPL__</span></code> macro family</a></li>
<li><a class="reference internal" href="#other-macros">Other macros</a></li>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#attribute-traits">Attribute traits</a><ul>
<li><a class="reference internal" href="#compile-time-flags">Compile-time flags</a></li>
<li><a class="reference internal" href="#runtime-traits">Runtime traits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#serialization-support">Serialization support</a><ul>
<li><a class="reference internal" href="#woo-object-postload">woo::Object::postLoad</a></li>
</ul>
</li>
<li><a class="reference internal" href="#casting">Casting</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="index.html"
                          title="Previous page">&larr; Programming manual</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="conventions.html"
                          title="Next page">&rarr; Conventions</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/prog/object.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="conventions.html" title="Conventions"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="index.html" title="Programming manual"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Woo 1.0+rev1-git-08c3989 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Programming manual</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">woo::Object</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2012−2022, Václav Šmilauer &lt;eu@doxos.eu&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>
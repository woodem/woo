


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Motion integration &#8212; Woo 1.0+rev1-git-19c947b documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"loader": {"load": ["[tex]/boldsymbol"]}, "TeX": {"Macros": {"prev": ["#1^-", 1], "pprev": ["#1^{\\ominus}", 1], "curr": ["#1^{\\circ}", 1], "nnext": ["#1^{\\oplus}", 1], "next": ["#1^{+}", 1], "Dt": "\\Delta t", "tens": ["{\\bf #1}", 1], "vec": ["{\\bf #1}", 1], "quat": ["{\\bf #1}", 1], "mat": ["{\\bf #1}", 1], "u": ["\\,\\mathrm{#1}", 1], "normalized": ["\\frac{#1}{|\\cdot|}", 1], "d": "\\mathrm{d}\\,", "phi": "\\varphi", "eps": "\\varepsilon", "epsilon": "\\varepsilon", "tr": "\\mathop{\\rm tr}\\nolimits"}, "packages": {"[+]": ["boldsymbol"]}}})</script>
    <script>window.MathJax = {"loader": {"load": ["[tex]/boldsymbol"]}, "TeX": {"Macros": {"prev": ["#1^-", 1], "pprev": ["#1^{\\ominus}", 1], "curr": ["#1^{\\circ}", 1], "nnext": ["#1^{\\oplus}", 1], "next": ["#1^{+}", 1], "Dt": "\\Delta t", "tens": ["{\\bf #1}", 1], "vec": ["{\\bf #1}", 1], "quat": ["{\\bf #1}", 1], "mat": ["{\\bf #1}", 1], "u": ["\\,\\mathrm{#1}", 1], "normalized": ["\\frac{#1}{|\\cdot|}", 1], "d": "\\mathrm{d}\\,", "phi": "\\varphi", "eps": "\\varepsilon", "epsilon": "\\varepsilon", "tr": "\\mathop{\\rm tr}\\nolimits"}, "packages": {"[+]": ["boldsymbol"]}}}</script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="../_static/woo-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Clumps" href="clumps.html" />
    <link rel="prev" title="Luding contact model" href="contact/luding.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="clumps.html" title="Clumps"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="contact/luding.html" title="Luding contact model"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Woo 1.0+rev1-git-19c947b documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Theory</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Motion integration</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="motion-integration">
<span id="theory-motion-integration"></span><h1>Motion integration<a class="headerlink" href="#motion-integration" title="Permalink to this headline">¶</a></h1>
<p>Motion integration consists in computing accelerations from forces/torques acting on nodes carrying mass and updating their positions/oritentations. Velocities are update based on accelerations, and positions are advanced.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Let us repeat: It must be carefully observed for which time-point is any value valid; this is show by using time-indices <span class="math notranslate nohighlight">\(\prev{x}\equiv x^{(t-\Dt)}\)</span>, <span class="math notranslate nohighlight">\(\pprev{x}\equiv x^{(t-\Dt/2)}\)</span>, <span class="math notranslate nohighlight">\(\curr{x}\equiv x^{(t)}\)</span>, <span class="math notranslate nohighlight">\(\nnext{x} \equiv x^{(t+\Dt/2)}\)</span>, <span class="math notranslate nohighlight">\(\next{x} \equiv x^{(t+\Dt)}\)</span>. Because of the leap-frog integration scheme, even derivatives of position (position, acceleration, forces, torques) are known at full-steps while odd derivatives (velocity) are known at mid-steps.</p>
</div>
<p>Motion integration is implemented in <a class="reference internal" href="../woo.dem.html#woo.dem.Leapfrog" title="woo.dem.Leapfrog"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.dem.Leapfrog</span></code></a>.</p>
<p>The summary force <span class="math notranslate nohighlight">\(\vec{F}_{\Sigma}\)</span> and torque <span class="math notranslate nohighlight">\(\vec{T}_{\Sigma}\)</span> include contributions from all relevant contacts, fields (such as gravity) and internal forces (e.g. from <a class="reference internal" href="membrane-element.html#membrane-element"><span class="std std-ref">Membrane element</span></a>).</p>
<div class="admonition-todo admonition" id="id1">
<p class="admonition-title">Todo</p>
<p>Mention how are forces from contacts summed up.</p>
</div>
<section id="position">
<h2>Position<a class="headerlink" href="#position" title="Permalink to this headline">¶</a></h2>
<p>Integrating position consists in using current acceleration <span class="math notranslate nohighlight">\(\curr{\vec{a}}\equiv\curr{\ddot{\vec{u}}}\)</span> on a node to update its position from the current value of <a class="reference internal" href="../woo.core.html#woo.core.Node.pos" title="woo.core.Node.pos"><code class="xref py py-obj docutils literal notranslate"><span class="pre">position</span></code></a> <span class="math notranslate nohighlight">\(\curr{\vec{u}}\)</span> to its value at the next timestep <span class="math notranslate nohighlight">\(\next{\vec{u}}\)</span>; we know the node’s <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.vel" title="woo.dem.DemData.vel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">velocity</span></code></a> <span class="math notranslate nohighlight">\(\pprev{\vec{v}}\equiv\pprev{\dot{\vec{u}}}\)</span>. Computation of acceleration, knowing the <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.force" title="woo.dem.DemData.force"><code class="xref py py-obj docutils literal notranslate"><span class="pre">current</span> <span class="pre">force</span></code></a> <span class="math notranslate nohighlight">\(\vec{F}_{\Sigma}\)</span> acting on the node in question and its <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.mass" title="woo.dem.DemData.mass"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mass</span></code></a> <span class="math notranslate nohighlight">\(m\)</span>, is simply</p>
<div class="math notranslate nohighlight">
\[\curr{\vec{a}}=\frac{\curr{\vec{F}_{\Sigma}}}{m}\]</div>
<p>Using the 2-nd order finite difference approximation with step <span class="math notranslate nohighlight">\(\Dt\)</span>, we obtain</p>
<div class="math notranslate nohighlight">
\[\curr{\vec{a}}\cong\frac{\prev{\vec{u}}-2\curr{\vec{u}}+\next{\vec{u}}}{\Dt^2}\]</div>
<p>from which we express</p>
<div class="math notranslate nohighlight">
\[\begin{split}\next{\vec{u}}&amp;=2\curr{\vec{u}}-\prev{\vec{u}}+\curr{\vec{a}}\Dt^2 =\\
        &amp;=\curr{\vec{u}}+\Dt\underbrace{\left(\frac{\curr{\vec{u}}-\prev{\vec{u}}}{\Dt}+\curr{\vec{a}}\Dt\right)}_{(\dagger)}.\end{split}\]</div>
<p>Typically, <span class="math notranslate nohighlight">\(\prev{\vec{u}}\)</span> is already not known (only <span class="math notranslate nohighlight">\(\curr{\vec{u}}\)</span> is); we notice, however, that</p>
<div class="math notranslate nohighlight">
\[\pprev{\vec{v}}\simeq\frac{\curr{\vec{u}}-\prev{\vec{u}}}{\Dt},\]</div>
<p>i.e. the mean velocity during the previous step, which is known. Plugging this approximate into the <span class="math notranslate nohighlight">\((\dagger)\)</span> term, we also notice that mean velocity during the current step can be approximated as</p>
<div class="math notranslate nohighlight">
\[\nnext{\vec{v}}\simeq\pprev{\vec{v}}+\curr{\vec{a}}\Dt,\]</div>
<p>which is <span class="math notranslate nohighlight">\((\dagger)\)</span>; we arrive finally at</p>
<div class="math notranslate nohighlight">
\[\next{\vec{u}}=\curr{\vec{u}}+\Dt\left(\pprev{\vec{v}}+\curr{\vec{a}}\Dt\right).\]</div>
<p>The algorithm can then be written down by first computing current mean velocity <span class="math notranslate nohighlight">\(\nnext{\vec{v}}\)</span> which we need to store for the next step (just as we use its old value <span class="math notranslate nohighlight">\(\pprev{\vec{v}}\)</span> now), then computing the position for the next time step <span class="math notranslate nohighlight">\(\next{\vec{u}}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-eq-leapfrog-nnextvel">
<span class="eqno">(28)<a class="headerlink" href="#equation-eq-leapfrog-nnextvel" title="Permalink to this equation">¶</a></span>\[\begin{split}\nnext{\vec{v}}=\pprev{\vec{v}}+\curr{\vec{a}}\Dt \\
\next{\vec{u}}=\curr{\vec{u}}+\nnext{\vec{v}}\Dt.\end{split}\]</div>
<p>Positions are known at times <span class="math notranslate nohighlight">\(i\Delta t\)</span> (if <span class="math notranslate nohighlight">\(\Delta t\)</span> is constant) while velocities are known at <span class="math notranslate nohighlight">\(i\Delta t+\frac{\Delta t}{2}\)</span>. The fact that they interleave (jump over each other) in such way gave rise to the colloquial name “leap-frog”.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The initial (often zero) nodal velocity <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.vel" title="woo.dem.DemData.vel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DemData.vel</span></code></a>, before motion is integrated for the first time, is usually understood to be <span class="math notranslate nohighlight">\(\curr{\vec{v}}\)</span> rather than <span class="math notranslate nohighlight">\(\pprev{\vec{v}}\)</span>. In that case, <a class="reference internal" href="#equation-eq-leapfrog-nnextvel">(28)</a> is modified to read <span class="math notranslate nohighlight">\(\nnext{\vec{v}}=\curr{\vec{v}}+\curr{\vec{a}}\Dt/2\)</span>. The <code class="xref py py-obj docutils literal notranslate"><span class="pre">DemData.velMidstep</span></code> bit is used to know whether the node has already been encountered by the integrator or not. This adjustment can be turned off by unsetting <code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.dem.Leapfrog.adjVel0</span></code>.</p>
</div>
</section>
<section id="orientation">
<h2>Orientation<a class="headerlink" href="#orientation" title="Permalink to this headline">¶</a></h2>
<section id="spherical-nodes">
<h3>Spherical nodes<a class="headerlink" href="#spherical-nodes" title="Permalink to this headline">¶</a></h3>
<p>The basic integration procedure applies to nodes which have inertia tensor such that <span class="math notranslate nohighlight">\(\tens{I}_{11}=\tens{I}_{22}=\tens{I}_{33}\)</span> (this tensor is always diagonal, since local node coordinates coincide with principal axes, and is stored as a 3-vector in <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.inertia" title="woo.dem.DemData.inertia"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.dem.DemData.inertia</span></code></a>; the sphericity can be queried via <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.isAspherical" title="woo.dem.DemData.isAspherical"><code class="xref py py-obj docutils literal notranslate"><span class="pre">isAspherical</span></code></a>).</p>
<div class="math notranslate nohighlight" id="equation-eq-leapfrog-nnextangvel">
     \begin{align*}
   \curr{\dot{\vec{\omega}}}&amp;=\frac{\curr{\vec{T}_{\Sigma}}}{\tens{I}_{11}} \\
   \nnext{\vec{\omega}}&amp;=\pprev{\vec{\omega}}+\curr{\dot{\vec{\omega}}}\Dt \\
   \next{\vec{q}}&amp;=\mathrm{Quaternion}(\nnext{\vec{\omega}}\Dt)\curr{\vec{q}}
     \end{align*}</div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>As with linear velocity, the first motion integration modifies the equation to read <span class="math notranslate nohighlight">\(\nnext{\vec{\omega}}=\curr{\vec{\omega}}+\curr{\dot{\vec{\omega}}}\Dt/2\)</span>, under the conditions explained above.</p>
</div>
</section>
<section id="aspherical-nodes">
<h3>Aspherical nodes<a class="headerlink" href="#aspherical-nodes" title="Permalink to this headline">¶</a></h3>
<p>Aspherical nodes have different moment of inertia along each principal axis. Their positions are integrated in the same ways as with spherical nodes.</p>
<p>Integrating rotation is considerably more complicated as the local reference frame is not inertial. Rotation of rigid body in the local frame, where inertia tensor <span class="math notranslate nohighlight">\(\mat{I}\)</span> is diagonal, is described in the continuous form by Euler’s equations (<span class="math notranslate nohighlight">\(i\in\{1,2,3\}\)</span>, and <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(j\)</span>, <span class="math notranslate nohighlight">\(k\)</span> being sequential):</p>
<div class="math notranslate nohighlight">
\[\vec{T}_i=\mat{I}_{ii}\dot{\vec{\omega}}_i+(\mat{I}_{kk}-\mat{I}_{jj})\vec{\omega}_j\vec{\omega}_k.\]</div>
<p>Due to the presence of the current values of both <span class="math notranslate nohighlight">\(\vec{\omega}\)</span> and <span class="math notranslate nohighlight">\(\dot{\vec{\omega}}\)</span>, they cannot be solved using the standard leapfrog algorithm.</p>
<p>The algorithm presented here is described by <span id="id2">[<a class="reference internal" href="../references.html#id18" title="M. P. Allen and D. J. Tildesley. Computer simulation of liquids. Clarendon Press, New York, NY, USA, 1989. ISBN 0-19-855645-4.">AT89</a>]</span> (pg. 84–89) and was designed by Fincham for molecular dynamics problems; it is based on extending the leapfrog algorithm by mid-step/on-step estimators of quantities known at on-step/mid-step points in the basic formulation. Although it has received criticism and more precise algorithms are known (<span id="id3">[<a class="reference internal" href="../references.html#id19" title="Igor P. Omelyan. A new leapfrog integrator of rotational motion. the revised angular-momentum approach. Molecular Simulation, 1999. URL: http://arxiv.org/pdf/physics/9901025, doi:10.1080/08927029908022097.">Ome99</a>]</span>, <span id="id4">[<a class="reference internal" href="../references.html#id20" title="Natale Neto and Luca Bellucci. A new algorithm for rigid body molecular dynamics. Chemical Physics, 328(1–3):259–268, 2006. doi:10.1016/j.chemphys.2006.07.009.">NB06</a>]</span>, <span id="id5">[<a class="reference internal" href="../references.html#id21" title="Scott M. Johnson, John R. Williams, and Benjamin K. Cook. Quaternion-based rigid body rotation integration algorithms for use in particle methods. International Journal for Numerical Methods in Engineering, 74(8):1303–1313, 2008. doi:10.1002/nme.2210.">JWC08</a>]</span>), this one is currently implemented in Woo for its relative simplicity.</p>
<p>Each node has its local coordinate system aligned with the principal axes of inertia; we use <span class="math notranslate nohighlight">\(\tilde{\bullet}\)</span> to denote vectors in local coordinates. The orientation of the local system is given by the current <a class="reference internal" href="../woo.core.html#woo.core.Node.ori" title="woo.core.Node.ori"><code class="xref py py-obj docutils literal notranslate"><span class="pre">node</span> <span class="pre">orientation</span></code></a> <span class="math notranslate nohighlight">\(\curr{q}\)</span> as a quaternion; this quaternion can be expressed as the (current) rotation matrix <span class="math notranslate nohighlight">\(\mat{A}\)</span>. Therefore, every vector <span class="math notranslate nohighlight">\(\vec{a}\)</span> is transformed as <span class="math notranslate nohighlight">\(\tilde{\vec{a}}=q\vec{a}q^{*}=\mat{A}\vec{a}\)</span>. Since <span class="math notranslate nohighlight">\(\mat{A}\)</span> is a rotation (orthogonal) matrix, the inverse rotation <span class="math notranslate nohighlight">\(\mat{A}^{-1}=\mat{A}^{T}\)</span>.</p>
<p>For the node in question, we know</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\curr{\tilde{\mat{I}}}\)</span> (constant) <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.inertia" title="woo.dem.DemData.inertia"><code class="xref py py-obj docutils literal notranslate"><span class="pre">inertia</span> <span class="pre">tensor</span> <span class="pre">diagonal</span></code></a> (non-diagonal items are zero, since local coordinates are principal),</p></li>
<li><p><span class="math notranslate nohighlight">\(\curr{\vec{T}}\)</span> external <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.torque" title="woo.dem.DemData.torque"><code class="xref py py-obj docutils literal notranslate"><span class="pre">torque</span></code></a>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\curr{q}\)</span> current <a class="reference internal" href="../woo.core.html#woo.core.Node.ori" title="woo.core.Node.ori"><code class="xref py py-obj docutils literal notranslate"><span class="pre">orientation</span> <span class="pre">(</span></code></a> and its equivalent rotation matrix <span class="math notranslate nohighlight">\(\mat{A}\)</span>),</p></li>
<li><p><span class="math notranslate nohighlight">\(\pprev{\vec{\omega}}\)</span>  mid-step <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.angVel" title="woo.dem.DemData.angVel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">angular</span> <span class="pre">velocity</span></code></a>,</p></li>
<li><p><span class="math notranslate nohighlight">\(\pprev{\vec{L}}\)</span> mid-step <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.angMom" title="woo.dem.DemData.angMom"><code class="xref py py-obj docutils literal notranslate"><span class="pre">angular</span> <span class="pre">momentum</span></code></a>; this is an auxiliary variable that must be tracked additionally for use in this algorithm. It will be zero in the initial step.</p></li>
</ul>
<p>Our goal is to compute new values of the latter three, i.e. <span class="math notranslate nohighlight">\(\nnext{\vec{L}}\)</span>, <span class="math notranslate nohighlight">\(\next{q}\)</span>, <span class="math notranslate nohighlight">\(\nnext{\vec{\omega}}\)</span>. We first estimate current angular momentum and compute current local angular velocity:</p>
<div class="math notranslate nohighlight">
\begin{align*}
        \curr{\vec{L}}&amp;=\pprev{\vec{L}}+\curr{\vec{T}}\frac{\Dt}{2}, &amp;\curr{\tilde{\vec{L}}}&amp;=\mat{A}\curr{\vec{L}}, \\
        \nnext{\vec{L}}&amp;=\pprev{\vec{L}}+\curr{\vec{T}}\Dt, &amp;\nnext{\tilde{\vec{L}}}&amp;=\mat{A}\nnext{\vec{L}}, \\
        \tilde{\curr{\vec{\omega}}}&amp;=\curr{\tilde{\mat{I}}}{}^{-1}\curr{\tilde{\vec{L}}}, \\
        \nnext{\tilde{\vec{\omega}}}&amp;=\curr{\tilde{\mat{I}}}{}^{-1}\nnext{\tilde{\vec{L}}}. \\
\end{align*}</div><p>Then we compute <span class="math notranslate nohighlight">\(\curr{\dot{q}}\)</span> (see <a class="reference external" href="http://www.euclideanspace.com/physics/kinematics/angularvelocity/QuaternionDifferentiation2.pdf">Quaternion differentiation</a>), using <span class="math notranslate nohighlight">\(\curr{q}\)</span> and <span class="math notranslate nohighlight">\(\curr{\tilde{\vec{\omega}}}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-eq-quaternion-derivative">
        \begin{align*}
                \begin{pmatrix}\curr{\dot{q}}_w \\ \curr{\dot{q}}_x \\ \curr{\dot{q}}_y \\ \curr{\dot{q}}_z\end{pmatrix}&amp;=
                        \def\cq{\curr{q}}
                        \frac{1}{2}\begin{pmatrix}
                                \cq_w &amp; -\cq_x &amp; -\cq_y &amp; -\cq_z \\
                                \cq_x &amp; \cq_w &amp; -\cq_z &amp; \cq_y \\
                                \cq_y &amp; \cq_z &amp; \cq_w &amp; -\cq_x \\
                                \cq_z &amp; -\cq_y &amp; \cq_x &amp; \cq_w
                        \end{pmatrix}
                        \begin{pmatrix} 0 \\ \curr{\tilde{\vec{\omega}}}_x \\ \curr{\tilde{\vec{\omega}}}_y \\ \curr{\tilde{\vec{\omega}}}_z    \end{pmatrix},  \\
                        \nnext{q}&amp;=\curr{q}+\curr{\dot{q}}\frac{\Dt}{2}.\\
        \end{align*}</div><p>We evaluate <span class="math notranslate nohighlight">\(\nnext{\dot{q}}\)</span> from <span class="math notranslate nohighlight">\(\nnext{q}\)</span> and <span class="math notranslate nohighlight">\(\nnext{\tilde{\vec{\omega}}}\)</span> in the same way as in <a class="reference internal" href="#equation-eq-quaternion-derivative">(30)</a> but shifted by <span class="math notranslate nohighlight">\(\Dt/2\)</span> ahead. Then we can finally compute the desired values</p>
<div class="math notranslate nohighlight">
\begin{align*}
        \next{q}&amp;=\curr{q}+\nnext{\dot{q}}\Dt, \\
        \nnext{\vec{\omega}}&amp;=\mat{A}^{-1}\nnext{\tilde{\vec{\omega}}}.
\end{align*}</div></section>
</section>
<section id="motion-in-uniformly-deforming-space">
<h2>Motion in uniformly deforming space<a class="headerlink" href="#motion-in-uniformly-deforming-space" title="Permalink to this headline">¶</a></h2>
<p>In some simulations, nodes can be considered as moving within uniformly deforming medium with velocity gradient tensor <span class="math notranslate nohighlight">\(\tens{L}\)</span>, being stationary at origin. This functionality is provided by the <a class="reference internal" href="../woo.core.html#woo.core.Cell" title="woo.core.Cell"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.core.Cell</span></code></a> class (<a class="reference internal" href="../woo.core.html#woo.core.Scene.cell" title="woo.core.Scene.cell"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Scene.cell</span></code></a>), along with periodic boundaries. The equations written here only valid when <a class="reference internal" href="../woo.core.html#woo.core.Cell.homoDeform" title="woo.core.Cell.homoDeform"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Cell.homoDeform</span></code></a> has the value <code class="docutils literal notranslate"><span class="pre">Cell.homoGradV2</span></code>, which is the default.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is (currently) not possible to simulate deforming space without periodicity. As workaround, set the periodic space big enough to encompass the whole simulation.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The node’s <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.vel" title="woo.dem.DemData.vel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">linear</span></code></a> and <a class="reference internal" href="../woo.dem.html#woo.dem.DemData.angVel" title="woo.dem.DemData.angVel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">angular</span></code></a> velocities comprise both space and fluctuation velocity. It is (almost) only in the integrator that the two must be distinguished.</p>
</div>
<p>Spin is skew-symmetric (rotational) part of velocity gradient <span class="math notranslate nohighlight">\(\tens{W}=\frac{1}{2}(\tens{L}-\tens{L}^T)\)</span>; its <a class="reference external" href="http://en.wikipedia.org/wiki/Hodge_dual">Hodge dual</a> vector (noted <span class="math notranslate nohighlight">\(*\bullet\)</span>) is position-independent medium angular velocity. Local medium velocities (in cartesian coordinates) read</p>
<div class="math notranslate nohighlight">
\[\begin{split}\vec{v}_L&amp;=\tens{L}\vec{x} \\
\vec{\omega}_L&amp;=*\tens{W}\!/2\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\vec{\omega}_L\)</span> is written in cartesian coordinates component-wise as</p>
<div class="math notranslate nohighlight">
\[\omega_{Lk}=\frac{1}{2}\epsilon_{ijk}W_{ij}\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon_{ijk}\)</span> is the <a class="reference external" href="http://en.wikipedia.org/wiki/Levi-Civita_symbol">Levi-Civita symbol</a> (also known as “permutation tensor”).</p>
<section id="linear-velocity">
<h3>Linear velocity<a class="headerlink" href="#linear-velocity" title="Permalink to this headline">¶</a></h3>
<p>Velocity <span class="math notranslate nohighlight">\(\vec{v}\)</span> of each particle is sum of fluctuation velocity <span class="math notranslate nohighlight">\(\vec{v}_f\)</span> and local medium velocity <span class="math notranslate nohighlight">\(\vec{v}_L\)</span>. <span class="math notranslate nohighlight">\(\vec{v}\)</span> evolves not only by virtue of acceleration, but also of <span class="math notranslate nohighlight">\(\tens{L}\)</span>, defined at mid-step time-points. We add this term to <a class="reference internal" href="#equation-eq-leapfrog-nnextvel">(28)</a></p>
<div class="math notranslate nohighlight" id="equation-eq-nnext-v-simple">
<span class="eqno">(31)<a class="headerlink" href="#equation-eq-nnext-v-simple" title="Permalink to this equation">¶</a></span>\[\nnext{\vec{v}}=\pprev{\vec{v}}+\Dt\curr{\vec{a}}+\Dt\curr{\vec{\dot v}_L}\]</div>
<p>with</p>
<div class="math notranslate nohighlight" id="equation-eq-hvl-currv">
\begin{align*}
   \Dt\curr{\vec{\dot v}_L}&amp;=\Dt\partial_t(\curr{\tens{L}}\curr{\vec{x}})=\Dt(\curr{\tens{\dot L}}\curr{\vec{x}}+\curr{L}\curr{v})\approx\\
   &amp;\approx \Dt \left[\frac{\nnext{\tens{L}}-\pprev{\tens{L}}}{\Dt}\curr{\vec{x}}+\frac{\pprev{\tens{L}}+\nnext{\tens{L}}}{2}\curr{\vec{v}}\right].
\end{align*}</div><p>This equation can be rearranged as</p>
<div class="math notranslate nohighlight">
\[\Dt\curr{\vec{\dot v}_L}=-\pprev{\tens{L}}(\underbrace{\curr{\vec{x}}-\curr{\vec{v}}\frac{\Dt}{2}}_{\approx\pprev{\vec{x}}})+\nnext{\tens{L}}(\underbrace{\curr{\vec{x}}+\curr{\vec{v}}\frac{\Dt}{2}}_{\approx\nnext{\vec{x}}})\approx-\pprev{\tens{L}}\pprev{\vec{x}}+\nnext{\tens{L}}\nnext{\vec{x}}\]</div>
<p>showing that the correction <span class="math notranslate nohighlight">\(\Dt\curr{\vec{\dot v}_L}\)</span> corresponds to subtracting the previous field velocity and adding the current field velocity.</p>
<p>Going back to <a class="reference internal" href="#equation-eq-hvl-currv">(32)</a>, we write the unknown on-step velocity as <span class="math notranslate nohighlight">\(\curr{\vec{v}}\approx (\pprev{\vec{v}}+\nnext{\vec{v}})/2\)</span> and substitute <span class="math notranslate nohighlight">\(\Dt\curr{\vec{\dot v}_L}\)</span> into <a class="reference internal" href="#equation-eq-nnext-v-simple">(31)</a> obtaining</p>
<div class="math notranslate nohighlight">
\[\nnext{\vec{v}}=\left(\mat{1}-\frac{\nnext{\tens{L}}+\pprev{\tens{L}}}{4}\Dt\right)^{-1}\left[(\nnext{\tens{L}}-\pprev{\tens{L}})\curr{\vec{x}}+\left(\mat{1}+\frac{\nnext{\tens{L}}+\pprev{\tens{L}}}{4}\Dt\right)\pprev{\vec{v}}+\curr{\vec{a}}\Dt\right].\]</div>
<p>The position-independent terms are stored in <a class="reference internal" href="../woo.dem.html#woo.dem.Leapfrog.ImLL4hInv" title="woo.dem.Leapfrog.ImLL4hInv"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ImLL4hInv</span></code></a>, <a class="reference internal" href="../woo.dem.html#woo.dem.Leapfrog.LmL" title="woo.dem.Leapfrog.LmL"><code class="xref py py-obj docutils literal notranslate"><span class="pre">LmL</span></code></a>, <a class="reference internal" href="../woo.dem.html#woo.dem.Leapfrog.IpLL4h" title="woo.dem.Leapfrog.IpLL4h"><code class="xref py py-obj docutils literal notranslate"><span class="pre">IpLL4h</span></code></a> and are updated at each timestep. Both <span class="math notranslate nohighlight">\(\pprev{\tens{L}}\)</span> and <span class="math notranslate nohighlight">\(\nnext{\tens{L}}\)</span> must be know in this equations; they are stored in <a class="reference internal" href="../woo.core.html#woo.core.Cell.gradV" title="woo.core.Cell.gradV"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.core.Cell.gradV</span></code></a> and <a class="reference internal" href="../woo.core.html#woo.core.Cell.nextGradV" title="woo.core.Cell.nextGradV"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.core.Cell.nextGradV</span></code></a> respectively.</p>
</section>
<section id="angular-velocity">
<h3>Angular velocity<a class="headerlink" href="#angular-velocity" title="Permalink to this headline">¶</a></h3>
<p>As <span class="math notranslate nohighlight">\(\vec{\omega}_L\)</span> is only a function of time (not of space, unlike <span class="math notranslate nohighlight">\(\vec{v}_L\)</span>), <a class="reference internal" href="#equation-eq-leapfrog-nnextangvel">(29)</a> simply becomes</p>
<div class="math notranslate nohighlight">
\[\nnext{\vec{\omega}}=\pprev{\vec{\omega}}+\Dt\curr{\dot{\vec{\omega}}} \underbrace{- \pprev{\vec{\omega}_L}+\nnext{\vec{\omega}_L}}_{(\dagger)}\]</div>
<p>where the <span class="math notranslate nohighlight">\((\dagger)\)</span> term is stored as <a class="reference internal" href="../woo.dem.html#woo.dem.Leapfrog.deltaSpinVec" title="woo.dem.Leapfrog.deltaSpinVec"><code class="xref py py-obj docutils literal notranslate"><span class="pre">deltaSpinVec</span></code></a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Uniformly deforming medium integration is not implemented for aspherical particles, their rotation will be integrated pretending <span class="math notranslate nohighlight">\(\tens{W}\)</span> is zero.</p>
</div>
</section>
<section id="periodic-space">
<h3>Periodic space<a class="headerlink" href="#periodic-space" title="Permalink to this headline">¶</a></h3>
<p>Periodic space is defined as parallelepiped located at origin, expressed as <a class="reference internal" href="../woo.core.html#woo.core.Cell.hSize" title="woo.core.Cell.hSize"><code class="xref py py-obj docutils literal notranslate"><span class="pre">matrix</span></code></a> <span class="math notranslate nohighlight">\(\mat{H}\)</span> of which columns are its side vectors. Periodic space volume is given by <span class="math notranslate nohighlight">\(|\det\mat{H}|\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\mat{H}\)</span> follows motion of the space which can be written down as motion of a point <span class="math notranslate nohighlight">\(p\)</span> with zero fluctuation velocity and acceleration; linearizing its motion around mid-step, we obtain its next position as</p>
<div class="math notranslate nohighlight">
\[\next{\vec{p}}=\curr{\vec{p}}+\Dt\nnext{\tens{L}}\nnext{\vec{p}}\approx\curr{\vec{p}}+\Dt\nnext{\tens{L}}\frac{\curr{\vec{p}}+\next{\vec{p}}}{2}\]</div>
<p>from which <span class="math notranslate nohighlight">\(\next{\vec{p}}\)</span> is found as</p>
<div class="math notranslate nohighlight" id="equation-eq-fixed-point">
<span class="eqno">(33)<a class="headerlink" href="#equation-eq-fixed-point" title="Permalink to this equation">¶</a></span>\[\next{\vec{p}}=\left(\mat{1}-\nnext{\tens{L}}\frac{\Dt}{2}\right)^{-1}\left(\mat{1}+\nnext{\tens{L}}\frac{\Dt}{2}\right)\curr{\vec{p}}.\]</div>
<p>The <span class="math notranslate nohighlight">\(\mat{H}\)</span> matrix is updated in the same way, i.e.</p>
<div class="math notranslate nohighlight">
\[\next{\mat{H}}=\left(\mat{1}-\nnext{\tens{L}}\frac{\Dt}{2}\right)^{-1}\left(\mat{1}+\nnext{\tens{L}}\frac{\Dt}{2}\right)\curr{\mat{H}}.\]</div>
<p>The <a class="reference internal" href="../woo.core.html#woo.core.Cell.trsf" title="woo.core.Cell.trsf"><code class="xref py py-obj docutils literal notranslate"><span class="pre">transformation</span> <span class="pre">matrix</span></code></a> accumulates deformation from <span class="math notranslate nohighlight">\(\tens{L}\)</span> and is updated as</p>
<div class="math notranslate nohighlight">
\[\next{\mat{T}}=\curr{\mat{T}}+\pprev{\tens{L}}\curr{\mat{T}}\Dt.\]</div>
<p>If <span class="math notranslate nohighlight">\(\tens{L}\)</span> is diagonal, then the (initially zero) <span class="math notranslate nohighlight">\(\mat{T}\)</span> is also diagonal and is a strain matrix. Diagonal contains the <a class="reference external" href="http://en.wikipedia.org/wiki/Deformation_%28mechanics%29#True_strain">Hencky strain</a> along respective axes.</p>
</section>
</section>
<section id="clumps">
<h2>Clumps<a class="headerlink" href="#clumps" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id6">
<p class="admonition-title">Todo</p>
<p>Write about clump motion integration; write about <code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.dem.ClumpSpherePack</span></code> and how its properties are computed. Perhaps move clumps to a separate file.</p>
</div>
</section>
<section id="timestep">
<h2>Timestep<a class="headerlink" href="#timestep" title="Permalink to this headline">¶</a></h2>
<div class="admonition-todo admonition" id="id7">
<p class="admonition-title">Todo</p>
<p>Write on <span class="math notranslate nohighlight">\(\Dt\)</span>, how <a class="reference internal" href="../woo.core.html#woo.core.Scene" title="woo.core.Scene"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Scene</span></code></a> queries <a class="reference internal" href="../woo.core.html#woo.core.Field.critDt" title="woo.core.Field.critDt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">fields</span></code></a> and <a class="reference internal" href="../woo.core.html#woo.core.Engine.critDt" title="woo.core.Engine.critDt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">engines</span></code></a> on their timestep, about <a class="reference internal" href="../woo.core.html#woo.core.Scene.dtSafety" title="woo.core.Scene.dtSafety"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.core.Scene.dtSafety</span></code></a>, about <a class="reference internal" href="../woo.dem.html#woo.dem.DynDt" title="woo.dem.DynDt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.dem.DynDt</span></code></a>.</p>
</div>
</section>
<section id="numerical-damping">
<h2>Numerical damping<a class="headerlink" href="#numerical-damping" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This damping scheme is only suitable for quasi-static simulation where the dynamics is only auxiliary and not important as such. Using this damping scheme in dynamic simulations will lead to gross errors, such as free fall not happening correctly.</p>
</div>
<p>In simulations of quasi-static phenomena, it it desirable to dissipate kinetic energy of particles. Since some contact laws (such as <a class="reference internal" href="contact/linear.html#linear-contact-model"><span class="std std-ref">Linear (Cundall) contact model</span></a>) do not include velocity-based damping (such as one in <span id="id8">[Addetta2001]</span>), it is possible to use artificial numerical damping. The formulation is described in the manual of the PFC3D code, but the version used here is slightly adapted.</p>
<p>The basic idea is to decrease forces which increase the particle velocities and increase forces which decrease particle velocities by <span class="math notranslate nohighlight">\((\Delta F)_d\)</span>, comparing the current acceleration sense and particle velocity sense. This is done component-by-component, which makes the damping scheme clearly non-physical, as it is not invariant with respect to coordinate system rotation; on the other hand, it is very easy to compute. Cundall proposed the form (we omit particle indices $i$ since it applies to all of them separately):</p>
<div class="math notranslate nohighlight">
\[\frac{(\Delta \vec{F})_{dw}}{\vec{F}_w}=-\lambda_d\operatorname{sgn}(\vec{F}_w\pprev{\dot{\vec{u}}}_{w}),\quad w\in\{x,y,z\}\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda_d\)</span> is the damping coefficient. This formulation has several advantages <span id="id9">[Hentz2003]</span>:</p>
<ul class="simple">
<li><p>it acts on forces (accelerations), not constraining uniform motion;</p></li>
<li><p>it is independent of eigenfrequencies of particles, they will be all damped equally;</p></li>
<li><p>it needs only the dimensionless parameter <span class="math notranslate nohighlight">\(\lambda_d\)</span> which does not have to be scaled.</p></li>
</ul>
<p>Woo uses the adapted form</p>
<div class="math notranslate nohighlight" id="equation-eq-damping-woo">
<span class="eqno">(34)<a class="headerlink" href="#equation-eq-damping-woo" title="Permalink to this equation">¶</a></span>\[\frac{(\Delta\vec{F})_{dw}}{\vec{F}_w}=-\lambda_d\operatorname{sgn}\vec{F}_w\underbrace{\left(\pprev{\dot{u}}_w+\frac{\curr{\ddot{\vec{u}}}_w\Dt}{2}\right)}_{\simeq\curr{\dot{u}}_w},\]</div>
<p>where we replaced the previous mid-step velocity <span class="math notranslate nohighlight">\(\pprev{\dot{u}}\)</span> by its on-step estimate in parentheses. This is to avoid locked-in forces that appear if the velocity changes its sign due to force application at each step, i.e. when the particle in question oscillates around the position of equilibrium with <span class="math notranslate nohighlight">\(2\Dt\)</span> period.</p>
<p>Equation <a class="reference internal" href="#equation-eq-damping-woo">(34)</a> is implemented in <a class="reference internal" href="../woo.dem.html#woo.dem.Leapfrog" title="woo.dem.Leapfrog"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Leapfrog</span></code></a>; the damping coefficient <span class="math notranslate nohighlight">\(\lambda_d\)</span> is <a class="reference internal" href="../woo.dem.html#woo.dem.Leapfrog.damping" title="woo.dem.Leapfrog.damping"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Leapfrog.damping</span></code></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Report issues or inclarities to <a class="reference external" href="https://github.com/woodem/woo/issues">github</a>.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../contents.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Motion integration</a><ul>
<li><a class="reference internal" href="#position">Position</a></li>
<li><a class="reference internal" href="#orientation">Orientation</a><ul>
<li><a class="reference internal" href="#spherical-nodes">Spherical nodes</a></li>
<li><a class="reference internal" href="#aspherical-nodes">Aspherical nodes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#motion-in-uniformly-deforming-space">Motion in uniformly deforming space</a><ul>
<li><a class="reference internal" href="#linear-velocity">Linear velocity</a></li>
<li><a class="reference internal" href="#angular-velocity">Angular velocity</a></li>
<li><a class="reference internal" href="#periodic-space">Periodic space</a></li>
</ul>
</li>
<li><a class="reference internal" href="#clumps">Clumps</a></li>
<li><a class="reference internal" href="#timestep">Timestep</a></li>
<li><a class="reference internal" href="#numerical-damping">Numerical damping</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="contact/luding.html"
                          title="Previous page">&larr; Luding contact model</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="clumps.html"
                          title="Next page">&rarr; Clumps</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/theory/leapfrog.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="clumps.html" title="Clumps"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="contact/luding.html" title="Luding contact model"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Woo 1.0+rev1-git-19c947b documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >Theory</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Motion integration</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2012−2021, Václav Šmilauer &lt;eu@doxos.eu&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.3.1.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>
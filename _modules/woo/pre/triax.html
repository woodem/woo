


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>woo.pre.triax &#8212; Woo 1.0+rev1-git-f6fbd0c documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>

    
    
     
        <script src="../../../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../../../_static/cloud.base.js"></script>
    

    
     
        <script src="../../../_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="../../../_static/woo-favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">Woo 1.0+rev1-git-f6fbd0c documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">woo.pre.triax</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for woo.pre.triax</h1><div class="highlight"><pre>
<span></span><span class="c1"># encoding: utf-8</span>

<span class="kn">from</span> <span class="nn">woo.dem</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">woo.core</span>
<span class="kn">import</span> <span class="nn">woo.dem</span>
<span class="kn">import</span> <span class="nn">woo.pyderived</span>
<span class="kn">import</span> <span class="nn">woo.triangulated</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">minieigen</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">woo.models</span>



<div class="viewcode-block" id="TriaxTest"><a class="viewcode-back" href="../../../woo.pre.html#woo.pre.triax.TriaxTest">[docs]</a><span class="k">class</span> <span class="nc">TriaxTest</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Preprocessor</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">pyderived</span><span class="o">.</span><span class="n">PyWooObject</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Preprocessor for triaxial test with rigid boundary. The test is run in 2 stages:</span>
<span class="sd">    </span>
<span class="sd">        * **compaction** where random loose packing is compressed to attain :math:`\sigma_{\rm iso}` (:obj:`sigIso`) in all directions. The compaction finishes when the stress level is sufficiently close to :obj:`sigIso` and unbalanced force drops below :obj:`maxUnbalanced`.</span>

<span class="sd">        * **Triaxial compression**: displacement-controlled compression along the ``z``-axis, with strain rate increasing until :obj:`maxRates` is reached; the test finished when axial strain attains :obj:`stopStrain`. During this phase, lateral (:math:`x` and :math:`y`) stresses are maintained at :math:`\sigma_{\rm iso}`, as much as possible.</span>

<span class="sd">    .. youtube:: qWZBCQbS6x4</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_classTraits</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_PAT</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">pyderived</span><span class="o">.</span><span class="n">PyAttrTrait</span> <span class="c1"># less typing</span>

    <span class="k">def</span> <span class="nf">postLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">I</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preCooked</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Applying pre-cooked configuration &quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">preCooked</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">preCooked</span><span class="o">==</span><span class="s1">&#39;Spheres in cylinder&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">PsdSphereGenerator</span><span class="p">(</span><span class="n">psdPts</span><span class="o">=</span><span class="p">[(</span><span class="o">.</span><span class="mi">01</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="o">.</span><span class="mi">04</span><span class="p">,</span><span class="mf">1.</span><span class="p">)])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="s1">&#39;cylinder&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">preCooked</span><span class="o">==</span><span class="s1">&#39;Capsules in cylinder&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">PsdCapsuleGenerator</span><span class="p">(</span><span class="n">psdPts</span><span class="o">=</span><span class="p">[(</span><span class="o">.</span><span class="mi">01</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="o">.</span><span class="mi">04</span><span class="p">,</span><span class="mf">1.</span><span class="p">)],</span><span class="n">shaftRadiusRatio</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="mf">1.2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="s1">&#39;cylinder&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">preCooked</span><span class="o">==</span><span class="s1">&#39;Ellipsoids in box&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">PsdEllipsoidGenerator</span><span class="p">(</span><span class="n">psdPts</span><span class="o">=</span><span class="p">[(</span><span class="o">.</span><span class="mi">01</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="o">.</span><span class="mi">04</span><span class="p">,</span><span class="mf">1.</span><span class="p">)],</span><span class="n">axisRatio2</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span><span class="o">.</span><span class="mi">9</span><span class="p">),</span><span class="n">axisRatio3</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="s1">&#39;box&#39;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">preCooked</span><span class="o">==</span><span class="s1">&#39;Sphere clumps in box&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">generator</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">PsdClumpGenerator</span><span class="p">(</span><span class="n">psdPts</span><span class="o">=</span><span class="p">[(</span><span class="o">.</span><span class="mi">01</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="o">.</span><span class="mi">04</span><span class="p">,</span><span class="mf">1.</span><span class="p">)],</span><span class="n">clumps</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">SphereClumpGeom</span><span class="p">(</span><span class="n">centers</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-.</span><span class="mi">15</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-.</span><span class="mi">05</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">)],</span><span class="n">radii</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="o">.</span><span class="mi">08</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">),</span><span class="n">scaleProb</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">)]),</span>
                    <span class="n">SphereClumpGeom</span><span class="p">(</span><span class="n">centers</span><span class="o">=</span><span class="p">[(</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">)],</span><span class="n">radii</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">,</span><span class="o">.</span><span class="mi">05</span><span class="p">),</span><span class="n">scaleProb</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="o">.</span><span class="mi">5</span><span class="p">)]),</span>
                <span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="o">=</span><span class="s1">&#39;box&#39;</span>
            <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Unknown precooked configuration &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">preCooked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">preCooked</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

    <span class="n">_attrTraits</span><span class="o">=</span><span class="p">[</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="s1">&#39;preCooked&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">noDump</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">noGui</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">startGroup</span><span class="o">=</span><span class="s1">&#39;Predefined config&#39;</span><span class="p">,</span><span class="n">choice</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;Spheres in cylinder&#39;</span><span class="p">,</span><span class="s1">&#39;Capsules in cylinder&#39;</span><span class="p">,</span><span class="s1">&#39;Ellipsoids in box&#39;</span><span class="p">,</span><span class="s1">&#39;Sphere clumps in box&#39;</span><span class="p">],</span><span class="n">triggerPostLoad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Apply pre-cooked configuration (i.e. change other parameters); this option is not saved.&#39;</span><span class="p">),</span>

        <span class="c1"># noGui would make startGroup being ignored</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;sigIso&#39;</span><span class="p">,</span><span class="o">-</span><span class="mf">500e3</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;kPa&#39;</span><span class="p">,</span><span class="n">startGroup</span><span class="o">=</span><span class="s1">&#39;General&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Confining stress (isotropic during compaction)&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="n">Vector3</span><span class="p">,</span><span class="s1">&#39;maxRates&#39;</span><span class="p">,(</span><span class="mf">2e-1</span><span class="p">,</span><span class="mf">2e-1</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span><span class="s1">&#39;Maximum strain rate during the compaction phase (for all directions), during the triaxial phase in axial sense, and during the triaxial phase in radial sense(s).&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;stopStrain&#39;</span><span class="p">,</span><span class="o">-.</span><span class="mi">3</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Goal value of axial deformation in the triaxial phase&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span><span class="s1">&#39;planeStrain&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;(For demonstration purposes only:) during the triaxial phase, prescribe zero displacement along :math:`x` and stress-control only :math:`y`-axis.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="s1">&#39;shape&#39;</span><span class="p">,</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span><span class="n">choice</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">,</span><span class="s1">&#39;box&#39;</span><span class="p">,</span><span class="s1">&#39;cylinder&#39;</span><span class="p">),</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Shape of the volume being compressed; *cell* is rectangular periodic cell, *box* is rectangular :obj:`~woo.dem.Wall`-delimited box, *cylinder* is triangulated cylinder aligned with the :math:`z`-axis&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="n">Vector3</span><span class="p">,</span><span class="s1">&#39;iniSize&#39;</span><span class="p">,(</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">3</span><span class="p">,</span><span class="o">.</span><span class="mi">6</span><span class="p">),</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Initial size of the volume; when :obj:`shape` is ``cylinder``, the second (:math:`y`) dimension is ignored.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">ParticleGenerator</span><span class="p">,</span><span class="s1">&#39;generator&#39;</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">PsdCapsuleGenerator</span><span class="p">(</span><span class="n">psdPts</span><span class="o">=</span><span class="p">[(</span><span class="o">.</span><span class="mi">01</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="o">.</span><span class="mi">04</span><span class="p">,</span><span class="mf">1.</span><span class="p">)],</span><span class="n">shaftRadiusRatio</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">6</span><span class="p">,</span><span class="mf">1.2</span><span class="p">)),</span>
            <span class="c1"># woo.dem.PsdEllipsoidGenerator(psdPts=[(.01,0),(.04,1.)],axisRatio2=(.5,.9),axisRatio3=(.3,.7))</span>
            <span class="c1"># woo.dem.PsdSphereGenerator(psdPts=[(.01,0),(.04,1.)])</span>
            <span class="s1">&#39;Particle generator; partices are then randomly placed in the volume.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ContactModelSelector</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ContactModelSelector</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span><span class="n">damping</span><span class="o">=.</span><span class="mi">7</span><span class="p">,</span><span class="n">numMat</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">matDesc</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;particles&#39;</span><span class="p">,</span><span class="s1">&#39;boundary&#39;</span><span class="p">],</span><span class="n">mats</span><span class="o">=</span><span class="p">[</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">FrictMat</span><span class="p">(</span><span class="n">density</span><span class="o">=</span><span class="mf">1e7</span><span class="p">,</span><span class="n">young</span><span class="o">=</span><span class="mf">1e8</span><span class="p">)]),</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Select contact model. The first material is for particles; the second, optional, material, is for the boundary (the first material is used if there is no second one).&#39;</span><span class="p">),</span>

        <span class="n">_PAT</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="s1">&#39;reportFmt&#39;</span><span class="p">,</span><span class="s2">&quot;/tmp/</span><span class="si">{tid}</span><span class="s2">.xhtml&quot;</span><span class="p">,</span><span class="n">startGroup</span><span class="o">=</span><span class="s2">&quot;Outputs&quot;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Report output format; :obj:`Scene.tags &lt;woo.core.Scene.tags&gt;` can be used.&quot;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="s1">&#39;saveFmt&#39;</span><span class="p">,</span><span class="s2">&quot;/tmp/</span><span class="si">{tid}</span><span class="s2">-</span><span class="si">{stage}</span><span class="s2">.bin.gz&quot;</span><span class="p">,</span><span class="s1">&#39;&#39;&#39;Savefile format; keys are :obj:`Scene.tags &lt;woo.core.Scene.tags&gt;`; additionally ``</span><span class="si">{stage}</span><span class="s1">`` will be replaced by</span>
<span class="s1">* ``init`` for stress-free but compact cloud,</span>
<span class="s1">* ``iso`` after isotropic compaction,</span>
<span class="s1">* ``backup-011234`` for regular backups, see :obj:`backupSaveTime`, &#39;done&#39; at the very end.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">),</span>
        <span class="c1"># _PAT(int,&#39;backupSaveTime&#39;,1800,doc=&#39;How often to save backup of the simulation (0 or negative to disable)&#39;),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;dtSafety&#39;</span><span class="p">,</span><span class="o">.</span><span class="mi">7</span><span class="p">,</span><span class="n">startGroup</span><span class="o">=</span><span class="s1">&#39;Tunables&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;See :obj:`woo.core.Scene.dtSafety`.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;maxUnbalanced&#39;</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Maximum unbalanced force at the end of compaction&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="s1">&#39;cylDiv&#39;</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="n">hideIf</span><span class="o">=</span><span class="s1">&#39;self.shape!=&quot;cylinder&quot;&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Number of segments to approximate the cylinder with.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;massFactor&#39;</span><span class="p">,</span><span class="o">.</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;Multiply real mass of particles by this number to obtain the :obj:`woo.dem.WeirdTriaxControl.mass` control parameter&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;rateStep&#39;</span><span class="p">,</span><span class="o">.</span><span class="mi">01</span><span class="p">,</span><span class="s1">&#39;Increase strain rate by this relative amount at the beginning of the triaxial phase, until the value given in :obj:`maxRates` is reached.&#39;</span><span class="p">),</span>
    <span class="p">]</span>
<div class="viewcode-block" id="TriaxTest.__new__"><a class="viewcode-back" href="../../../woo.pre.html#woo.pre.triax.TriaxTest.__new__">[docs]</a>    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">=</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wooPyInit</span><span class="p">(</span><span class="n">TriaxTest</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Preprocessor</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Preprocessor</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wooPyInit</span><span class="p">(</span><span class="n">TriaxTest</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Preprocessor</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<div class="viewcode-block" id="TriaxTest.__call__"><a class="viewcode-back" href="../../../woo.pre.html#woo.pre.triax.TriaxTest.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># preprocessor builds the simulation when called</span>
        <span class="k">return</span> <span class="n">prepareTriax</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="prepareTriax"><a class="viewcode-back" href="../../../woo.pre.html#woo.pre.triax.prepareTriax">[docs]</a><span class="k">def</span> <span class="nf">prepareTriax</span><span class="p">(</span><span class="n">pre</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">woo</span>
    <span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">usesApi</span><span class="o">=</span><span class="mi">10102</span>
    <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">DemField</span><span class="p">()])</span>
    <span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
    <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">partMat</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">wallMat</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">partMat</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pre</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mats</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="n">pre</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mats</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># initially no friciton</span>
    <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">partMat</span><span class="o">.</span><span class="n">tanPhi</span><span class="o">=</span><span class="mf">0.</span>

    <span class="n">partMask</span><span class="o">=</span><span class="mb">0b0001</span>
    <span class="n">wallMask</span><span class="o">=</span><span class="mb">0b0011</span>
    <span class="n">loneMask</span><span class="o">=</span><span class="mb">0b0010</span>
    <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">loneMask</span><span class="o">=</span><span class="n">loneMask</span>

    <span class="n">margin</span><span class="o">=.</span><span class="mi">1</span>

    <span class="n">factoryKw</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">maxMass</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">maxNum</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">generator</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">generator</span><span class="p">,</span><span class="n">massRate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">maxAttempts</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span><span class="n">materials</span><span class="o">=</span><span class="p">[</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">partMat</span><span class="p">],</span><span class="n">shooter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">partMask</span><span class="p">,</span><span class="n">collideExisting</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pre</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="s1">&#39;cell&#39;</span><span class="p">:</span>
        <span class="n">factory</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">BoxInlet</span><span class="p">(</span><span class="n">box</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">),</span><span class="o">**</span><span class="n">factoryKw</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">relVol</span><span class="o">=</span><span class="mf">1.</span>
        <span class="n">margin</span><span class="o">=</span><span class="mf">0.</span> <span class="c1"># no margins, use the full volume</span>
    <span class="k">elif</span> <span class="n">pre</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="s1">&#39;box&#39;</span><span class="p">:</span>
        <span class="n">mid</span><span class="o">=</span><span class="p">(</span><span class="n">margin</span><span class="o">+.</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">sense</span> <span class="ow">in</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># make copy of mid</span>
                <span class="n">pos</span><span class="o">=</span><span class="n">Vector3</span><span class="p">(</span><span class="n">mid</span><span class="p">);</span> <span class="n">pos</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span><span class="o">-=</span><span class="n">sense</span><span class="o">*.</span><span class="mi">5</span><span class="o">*</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">[</span><span class="n">ax</span><span class="p">]</span>
                <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">wall</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">sense</span><span class="o">=</span><span class="n">sense</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="n">wallMat</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">wallMask</span><span class="p">),</span><span class="n">nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">factory</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">BoxInlet</span><span class="p">(</span><span class="n">box</span><span class="o">=</span><span class="p">(</span><span class="n">margin</span><span class="o">*</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">,(</span><span class="mi">1</span><span class="o">+</span><span class="n">margin</span><span class="p">)</span><span class="o">*</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">),</span><span class="o">**</span><span class="n">factoryKw</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">relVol</span><span class="o">=</span><span class="n">AlignedBox3</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">)</span><span class="o">.</span><span class="n">volume</span><span class="p">()</span><span class="o">/</span><span class="n">AlignedBox3</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">margin</span><span class="p">)</span><span class="o">*</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">)</span><span class="o">.</span><span class="n">volume</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">pre</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="s1">&#39;cylinder&#39;</span><span class="p">:</span>
        <span class="n">d</span><span class="p">,</span><span class="n">h</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">bot</span><span class="o">=</span><span class="n">Vector3</span><span class="p">((</span><span class="o">.</span><span class="mi">5</span><span class="o">+</span><span class="n">margin</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">,(</span><span class="o">.</span><span class="mi">5</span><span class="o">+</span><span class="n">margin</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="n">margin</span><span class="o">*</span><span class="n">h</span><span class="p">)</span>
        <span class="n">top</span><span class="o">=</span><span class="n">bot</span><span class="o">+</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">h</span><span class="p">)</span>
        <span class="n">factory</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">CylinderInlet</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">bot</span><span class="p">,</span><span class="n">ori</span><span class="o">=</span><span class="n">Quaternion</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)),</span><span class="n">radius</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span><span class="o">**</span><span class="n">factoryKw</span><span class="p">)</span>
        <span class="c1"># axDiv to make sure we don&#39;t have facet larger than half of the cell (collider limitation)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">triangulated</span><span class="o">.</span><span class="n">cylinder</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span><span class="n">top</span><span class="p">,</span><span class="n">radius</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="n">d</span><span class="p">,</span><span class="n">div</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">cylDiv</span><span class="p">,</span><span class="n">axDiv</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">capA</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">capB</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">wallCaps</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="n">wallMat</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">wallMask</span><span class="p">),</span><span class="n">nodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">relVol</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="n">AlignedBox3</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">margin</span><span class="p">)</span><span class="o">*</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">)</span><span class="o">.</span><span class="n">volume</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pre</span><span class="o">.</span><span class="n">generator</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">PsdEllipsoidGenerator</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;It is not possible to combine ellipsoids with cylindrical boundary, since Ellipsoid+Facet collisions are not (yet) supported.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Triax.shape must be one of &quot;cell&quot;, &quot;box&quot; or &quot;cylinder&quot;.&#39;</span><span class="p">)</span>

    <span class="c1"># generate as many particles as possible</span>
    <span class="c1"># list(woo.system.childClasses(woo.dem.BoundFunctor)) </span>
    <span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="n">factory</span><span class="p">]</span>
    <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of nodes:&#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">nodes</span><span class="p">))</span>

    <span class="n">S</span><span class="o">.</span><span class="n">periodic</span><span class="o">=</span><span class="kc">True</span>
    <span class="n">S</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">setBox</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">margin</span><span class="p">)</span><span class="o">*</span><span class="n">pre</span><span class="o">.</span><span class="n">iniSize</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">dtSafety</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">dtSafety</span>

    <span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">WeirdTriaxControl</span><span class="p">(</span><span class="n">goal</span><span class="o">=</span><span class="p">(</span><span class="n">pre</span><span class="o">.</span><span class="n">sigIso</span><span class="p">,</span><span class="n">pre</span><span class="o">.</span><span class="n">sigIso</span><span class="p">,</span><span class="n">pre</span><span class="o">.</span><span class="n">sigIso</span><span class="p">),</span><span class="n">maxStrainRate</span><span class="o">=</span><span class="p">(</span><span class="n">pre</span><span class="o">.</span><span class="n">maxRates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pre</span><span class="o">.</span><span class="n">maxRates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pre</span><span class="o">.</span><span class="n">maxRates</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">relVol</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">relVol</span><span class="p">,</span><span class="n">stressMask</span><span class="o">=</span><span class="mb">0b01111</span><span class="p">,</span><span class="n">globUpdate</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">maxUnbalanced</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">maxUnbalanced</span><span class="p">,</span><span class="n">mass</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">massFactor</span><span class="o">*</span><span class="nb">sum</span><span class="p">([</span><span class="n">n</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">mass</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">nodes</span><span class="p">]),</span><span class="n">doneHook</span><span class="o">=</span><span class="s1">&#39;import woo.pre.triax; woo.pre.triax.compactionDone(S)&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;triax&#39;</span><span class="p">,</span><span class="n">absStressTol</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span><span class="n">relStressTol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">),</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;import woo.pre.cylTriax; woo.pre.triax.addPlotData_checkProgress(S)&#39;</span><span class="p">)</span>
    <span class="p">]</span><span class="o">+</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">defaultEngines</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">pre</span><span class="o">.</span><span class="n">model</span><span class="p">,</span><span class="n">dynDtPeriod</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        
    <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">stage</span><span class="o">=</span><span class="s1">&#39;compact&#39;</span>
    <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">_setWritable</span><span class="p">(</span><span class="s1">&#39;stage&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">woo.gl</span>
        <span class="n">S</span><span class="o">.</span><span class="n">gl</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">gl</span><span class="o">.</span><span class="n">Renderer</span><span class="p">(</span><span class="n">dispScale</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">rotScale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cell</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">pre</span><span class="o">.</span><span class="n">shape</span><span class="o">==</span><span class="s1">&#39;cell&#39;</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span><span class="n">woo</span><span class="o">.</span><span class="n">gl</span><span class="o">.</span><span class="n">Gl1_DemField</span><span class="p">(</span><span class="n">colorBy</span><span class="o">=</span><span class="s1">&#39;radius&#39;</span><span class="p">),</span><span class="n">woo</span><span class="o">.</span><span class="n">gl</span><span class="o">.</span><span class="n">Gl1_CPhys</span><span class="p">(),</span><span class="n">woo</span><span class="o">.</span><span class="n">gl</span><span class="o">.</span><span class="n">Gl1_Wall</span><span class="p">(</span><span class="n">div</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="k">pass</span>
    
    <span class="k">return</span> <span class="n">S</span></div>

<div class="viewcode-block" id="addPlotData_checkProgress"><a class="viewcode-back" href="../../../woo.pre.html#woo.pre.triax.addPlotData_checkProgress">[docs]</a><span class="k">def</span> <span class="nf">addPlotData_checkProgress</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">stage</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;compact&#39;</span><span class="p">,</span><span class="s1">&#39;triax&#39;</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">woo</span>
    <span class="n">t</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">triax</span>

    <span class="n">sxx</span><span class="p">,</span><span class="n">syy</span><span class="p">,</span><span class="n">szz</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">stress</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span> 
    <span class="n">dotE</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">gradV</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
    <span class="n">dotEMax</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">maxStrainRate</span>
    <span class="c1"># net volume</span>
    <span class="n">vol</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">volume</span><span class="o">*</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">relVol</span>
    <span class="c1"># current radial stress</span>
    <span class="n">srr</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">sxx</span><span class="o">+</span><span class="n">syy</span><span class="p">)</span> 
    <span class="c1"># mean stress</span>
    <span class="n">p</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">stress</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">/</span><span class="mf">3.</span>
    <span class="c1"># deviatoric stress</span>
    <span class="n">q</span><span class="o">=</span><span class="n">szz</span><span class="o">-.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">sxx</span><span class="o">+</span><span class="n">syy</span><span class="p">)</span> 
    <span class="n">qDivP</span><span class="o">=</span><span class="p">(</span><span class="n">q</span><span class="o">/</span><span class="n">p</span> <span class="k">if</span> <span class="n">p</span><span class="o">!=</span><span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">stage</span><span class="o">==</span><span class="s1">&#39;compact&#39;</span><span class="p">:</span>
        <span class="c1">## t.strain is log(l/l0) for all components</span>
        <span class="n">exx</span><span class="p">,</span><span class="n">eyy</span><span class="p">,</span><span class="n">ezz</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">strain</span> 
        <span class="n">err</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">exx</span><span class="o">+</span><span class="n">eyy</span><span class="p">)</span>
        <span class="c1"># volumetric strain is not defined directly, and it is not needed either        </span>
        <span class="n">eVol</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># triaxial phase:</span>
        <span class="c1"># only axial strain (ezz) and volumetric strain (eVol) are known</span>
        <span class="c1">#</span>
        <span class="c1"># set the initial volume, if not yet done</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="p">,</span><span class="s1">&#39;netVol0&#39;</span><span class="p">):</span> <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">netVol0</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">volume</span><span class="o">*</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">relVol</span>
        <span class="c1"># axial strain is known; xy components irrelevant (inactive)</span>
        <span class="n">ezz</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">strain</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> 
        <span class="c1"># current volume / initial volume</span>
        <span class="n">eVol</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">vol</span><span class="o">/</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">netVol0</span><span class="p">)</span> 
        <span class="c1"># radial strain</span>
        <span class="n">err</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">eVol</span><span class="o">-</span><span class="n">ezz</span><span class="p">)</span> 
        <span class="c1"># undefined</span>
        <span class="n">exx</span><span class="o">=</span><span class="n">eyy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span> 

    <span class="c1"># deviatoric strain</span>
    <span class="n">eDev</span><span class="o">=</span><span class="n">ezz</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">err</span><span class="o">+</span><span class="n">ezz</span><span class="p">)</span> <span class="c1"># FIXME: is this correct?!</span>

    <span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">addData</span><span class="p">(</span><span class="n">unbalanced</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">unbalancedForce</span><span class="p">(),</span><span class="n">i</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">step</span><span class="p">,</span>
        <span class="n">sxx</span><span class="o">=</span><span class="n">sxx</span><span class="p">,</span><span class="n">syy</span><span class="o">=</span><span class="n">syy</span><span class="p">,</span><span class="n">srr</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">sxx</span><span class="o">+</span><span class="n">syy</span><span class="p">),</span><span class="n">szz</span><span class="o">=</span><span class="n">szz</span><span class="p">,</span>
        <span class="n">exx</span><span class="o">=</span><span class="n">exx</span><span class="p">,</span><span class="n">eyy</span><span class="o">=</span><span class="n">eyy</span><span class="p">,</span><span class="n">err</span><span class="o">=</span><span class="n">err</span><span class="p">,</span><span class="n">ezz</span><span class="o">=</span><span class="n">ezz</span><span class="p">,</span>
        <span class="n">dotE</span><span class="o">=</span><span class="n">dotE</span><span class="p">,</span><span class="n">dotErr</span><span class="o">=.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">dotE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">dotE</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
        <span class="n">dotEMax</span><span class="o">=</span><span class="n">dotEMax</span><span class="p">,</span>
        <span class="n">dotEMax_z_neg</span><span class="o">=-</span><span class="n">dotEMax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="n">eDev</span><span class="o">=</span><span class="n">eDev</span><span class="p">,</span><span class="n">eVol</span><span class="o">=</span><span class="n">eVol</span><span class="p">,</span>
        <span class="n">vol</span><span class="o">=</span><span class="n">vol</span><span class="p">,</span>
        <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="o">=</span><span class="n">q</span><span class="p">,</span><span class="n">qDivP</span><span class="o">=</span><span class="n">qDivP</span><span class="p">,</span>
        <span class="n">isTriax</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">stage</span><span class="o">==</span><span class="s1">&#39;triax&#39;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">),</span> <span class="c1"># to be able to filter data</span>
        <span class="c1"># parTanPhi=S.lab.partMat.tanPhi,</span>
        <span class="c1">#memTanPhi=S.lab.memMat.tanPhi,</span>
        <span class="c1">#suppTanPhi=S.lab.suppMat.tanPhi</span>
        <span class="c1"># save all available energy data</span>
        <span class="c1">#Etot=O.energy.total()#,**O.energy</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plots</span><span class="p">:</span>
        <span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plots</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;i&#39;</span><span class="p">:(</span><span class="s1">&#39;unbalanced&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;vol&#39;</span><span class="p">),</span><span class="s1">&#39;i &#39;</span><span class="p">:((</span><span class="s1">&#39;sxx&#39;</span><span class="p">,</span><span class="s1">&#39;syy&#39;</span><span class="p">,</span><span class="s1">&#39;szz&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">planeStrain</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;srr&#39;</span><span class="p">,</span><span class="s1">&#39;szz&#39;</span><span class="p">)),</span><span class="s1">&#39; i&#39;</span><span class="p">:((</span><span class="s1">&#39;exx&#39;</span><span class="p">,</span><span class="s1">&#39;eyy&#39;</span><span class="p">,</span><span class="s1">&#39;ezz&#39;</span><span class="p">,</span><span class="s1">&#39;eVol&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">planeStrain</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;err&#39;</span><span class="p">,</span><span class="s1">&#39;ezz&#39;</span><span class="p">,</span><span class="s1">&#39;eVol&#39;</span><span class="p">)),</span><span class="s1">&#39;i  &#39;</span><span class="p">:(</span><span class="s1">&#39;dotE_z&#39;</span><span class="p">,</span><span class="s1">&#39;dotEMax_z&#39;</span><span class="p">),</span>
            <span class="s1">&#39;eDev&#39;</span><span class="p">:((</span><span class="s1">&#39;qDivP&#39;</span><span class="p">,</span><span class="s1">&#39;g-&#39;</span><span class="p">),</span><span class="kc">None</span><span class="p">,(</span><span class="s1">&#39;eVol&#39;</span><span class="p">,</span><span class="s1">&#39;r-&#39;</span><span class="p">)),</span><span class="s1">&#39;p&#39;</span><span class="p">:(</span><span class="s1">&#39;q&#39;</span><span class="p">,),</span>
            <span class="c1"># energy plot</span>
            <span class="c1">#&#39; i &#39;:(O.energy.keys,None,&#39;Etot&#39;),</span>
        <span class="p">}</span>
        <span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">xylabels</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;i &#39;</span><span class="p">:(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="s1">&#39;Stress [Pa]&#39;</span><span class="p">,),</span><span class="s1">&#39; i&#39;</span><span class="p">:(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span><span class="s1">&#39;Strains [-]&#39;</span><span class="p">,</span><span class="s1">&#39;Strains [-]&#39;</span><span class="p">)}</span>
        <span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">labels</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;sxx&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{xx}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;syy&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{yy}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;szz&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{zz}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;srr&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{rr}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;surfLoad&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\sigma_{\rm hydro}$&#39;</span><span class="p">,</span>
            <span class="s1">&#39;exx&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\varepsilon_</span><span class="si">{xx}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;eyy&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\varepsilon_</span><span class="si">{yy}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;ezz&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\varepsilon_</span><span class="si">{zz}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;err&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\varepsilon_</span><span class="si">{rr}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;eVol&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\varepsilon_</span><span class="si">{v}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;vol&#39;</span><span class="p">:</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span><span class="s1">&#39;eDev&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\varepsilon_d$&#39;</span><span class="p">,</span><span class="s1">&#39;qDivP&#39;</span><span class="p">:</span><span class="s1">&#39;$q/p$&#39;</span><span class="p">,</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="s1">&#39;$p$&#39;</span><span class="p">,</span><span class="s1">&#39;q&#39;</span><span class="p">:</span><span class="s1">&#39;$q$&#39;</span><span class="p">,</span>
            <span class="s1">&#39;dotE_x&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\dot\varepsilon_</span><span class="si">{xx}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;dotE_y&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\dot\varepsilon_</span><span class="si">{yy}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;dotE_z&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\dot\varepsilon_</span><span class="si">{zz}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;dotE_rr&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\dot\varepsilon_</span><span class="si">{rr}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;dotEMax_z&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$\dot\varepsilon_</span><span class="si">{zz}</span><span class="s1">^{\rm max}$&#39;</span><span class="p">,</span><span class="s1">&#39;dotEMax_z_neg&#39;</span><span class="p">:</span><span class="sa">r</span><span class="s1">&#39;$-\dot\varepsilon_</span><span class="si">{zz}</span><span class="s1">^{\rm max}$&#39;</span>
        <span class="p">}</span>


    <span class="c1">## adjust rate in the triaxial stage</span>
    <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">stage</span><span class="o">==</span><span class="s1">&#39;triax&#39;</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">maxStrainRate</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">maxStrainRate</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">rateStep</span><span class="o">*</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">maxRates</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">maxRates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="compactionDone"><a class="viewcode-back" href="../../../woo.pre.html#woo.pre.triax.compactionDone">[docs]</a><span class="k">def</span> <span class="nf">compactionDone</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
    <span class="c1"># if S.lab.compactMemoize:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Compaction done at step&#39;</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">woo</span>
    <span class="n">t</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">triax</span>
    <span class="c1"># set the current cell configuration to be the reference one</span>
    <span class="n">S</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">trsf</span><span class="o">=</span><span class="n">Matrix3</span><span class="o">.</span><span class="n">Identity</span>
    <span class="n">S</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">refHSize</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">hSize</span>
    <span class="n">S</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">nextGradV</span><span class="o">=</span><span class="n">Matrix3</span><span class="o">.</span><span class="n">Zero</span> <span class="c1"># avoid spurious strain from the last gradV value</span>
    <span class="c1">##  S.lab.leapfrog.damping=.7 # increase damping to a larger value</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">planeStrain</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">stressMask</span><span class="o">=</span><span class="mb">0b0011</span> <span class="c1"># z is strain-controlled, xy are stress-controlled</span>
        <span class="n">t</span><span class="o">.</span><span class="n">goal</span><span class="o">=</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">sigIso</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">sigIso</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">stopStrain</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">stressMask</span><span class="o">=</span><span class="mb">0b0001</span> <span class="c1"># z is strain-controlled, y has zero strain, x is stress-controlled</span>
        <span class="n">t</span><span class="o">.</span><span class="n">goal</span><span class="o">=</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">sigIso</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">stopStrain</span><span class="p">)</span>
    <span class="c1"># start with small rate, increases later</span>
    <span class="n">t</span><span class="o">.</span><span class="n">maxStrainRate</span><span class="o">=</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">maxRates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">maxRates</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">rateStep</span><span class="o">*</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">maxRates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> 
    <span class="n">t</span><span class="o">.</span><span class="n">maxUnbalanced</span><span class="o">=</span><span class="mi">10</span> <span class="c1"># don&#39;t care about that</span>
    <span class="n">t</span><span class="o">.</span><span class="n">doneHook</span><span class="o">=</span><span class="s1">&#39;import woo.pre.triax; woo.pre.triax.triaxDone(S)&#39;</span>

    <span class="c1"># recover friction angle</span>
    <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">partMat</span><span class="o">.</span><span class="n">tanPhi</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mats</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tanPhi</span>
    <span class="c1"># force update of contact parameters</span>
    <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">contactLoop</span><span class="o">.</span><span class="n">updatePhys</span><span class="o">=</span><span class="s1">&#39;once&#39;</span>


    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">woo.gl</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">gl</span><span class="o">.</span><span class="n">Gl1_DemField</span><span class="o">.</span><span class="n">updateRefPos</span><span class="o">=</span><span class="kc">True</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span> <span class="k">pass</span>

    <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">stage</span><span class="o">=</span><span class="s1">&#39;triax&#39;</span>

    <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">saveFmt</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">saveFmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stage</span><span class="o">=</span><span class="s1">&#39;compact&#39;</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span><span class="o">**</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">tags</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving to&#39;</span><span class="p">,</span><span class="n">out</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>


<div class="viewcode-block" id="triaxDone"><a class="viewcode-back" href="../../../woo.pre.html#woo.pre.triax.triaxDone">[docs]</a><span class="k">def</span> <span class="nf">triaxDone</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Triaxial done at step&#39;</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">saveFmt</span><span class="p">:</span>
        <span class="n">out</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">saveFmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stage</span><span class="o">=</span><span class="s1">&#39;done&#39;</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span><span class="o">**</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">tags</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving to&#39;</span><span class="p">,</span><span class="n">out</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">S</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">woo.utils</span>
    <span class="p">(</span><span class="n">repName</span><span class="p">,</span><span class="n">figs</span><span class="p">)</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">htmlReport</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">S</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">reportFmt</span><span class="p">,</span><span class="s1">&#39;Triaxial test with rigid boundary&#39;</span><span class="p">,</span><span class="n">afterHead</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">figures</span><span class="o">=</span><span class="p">[(</span><span class="kc">None</span><span class="p">,</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">noShow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">subPlots</span><span class="o">=</span><span class="kc">False</span><span class="p">)],</span><span class="n">svgEmbed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">woo</span><span class="o">.</span><span class="n">batch</span><span class="o">.</span><span class="n">writeResults</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">defaultDb</span><span class="o">=</span><span class="s1">&#39;triax.hdf5&#39;</span><span class="p">,</span><span class="n">series</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">postHooks</span><span class="o">=</span><span class="p">[</span><span class="n">woo</span><span class="o">.</span><span class="n">pre</span><span class="o">.</span><span class="n">cylTriax</span><span class="o">.</span><span class="n">plotBatchResults</span><span class="p">],</span><span class="n">simulationName</span><span class="o">=</span><span class="s1">&#39;triax&#39;</span><span class="p">,</span><span class="n">report</span><span class="o">=</span><span class="s1">&#39;file://&#39;</span><span class="o">+</span><span class="n">repName</span><span class="p">)</span></div>


</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">Woo 1.0+rev1-git-f6fbd0c documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">woo.pre.triax</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2012−2022, Václav Šmilauer &lt;eu@doxos.eu&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>



<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>woo.triangulated &#8212; Woo 1.0+rev1-git-1ff39f7 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>

    
    
     
        <script src="../../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../../_static/cloud.base.js"></script>
    

    
     
        <script src="../../_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="../../_static/woo-favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Woo 1.0+rev1-git-1ff39f7 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">woo.triangulated</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for woo.triangulated</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">minieigen</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">woo.pack</span><span class="o">,</span> <span class="nn">woo.utils</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">from</span> <span class="nn">woo._triangulated</span> <span class="k">import</span> <span class="o">*</span>
<span class="n">log</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">makeLog</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">_docInlineModules</span><span class="o">=</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">_triangulated</span><span class="p">,)</span>

<div class="viewcode-block" id="cylinder"><a class="viewcode-back" href="../../woo.triangulated.html#woo.triangulated.cylinder">[docs]</a><span class="k">def</span> <span class="nf">cylinder</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">radius</span><span class="p">,</span><span class="n">div</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">axDiv</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">capA</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">capB</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">masks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">wallCaps</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">angVel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">realRot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">fixed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return triangulated cylinder, as list of facets to be passed to :obj:`woo.dem.ParticleContainer.append`. ``**kw`` arguments are passed to :obj:`woo.pack.gtsSurface2Facets` (and thus to :obj:`woo.utils.facet`).</span>

<span class="sd">:param angVel: axial angular velocity of the cylinder</span>
<span class="sd">:param realRot: if true, impose :obj:`~woo.dem.StableCircularOrbit` on all cylinder nodes; if false, only assign :obj:`woo.dem.Facet.fakeVel` is assigned. In both cases, :obj:`~woo.dem.DemData.angVel` is set on cap walls (with *wallCaps*).</span>
<span class="sd">:param axDiv: divide the triangulation axially as well; the default creates facets spanning between both bases. If negative, it will attempt to have that ratio with circumferential division, e.g. specifying -1 will give nearly-square division.</span>
<span class="sd">:param wallCaps: create caps as walls (with :obj:`woo.dem.wall.glAB` properly set) rather than triangulation; cylinder axis *must* be aligned with some global axis in this case, otherwise and error is raised.</span>
<span class="sd">:param masks: mask values for cylinder, capA and capB respectively; it must be either *None* or a 3-tuple (regardless of whether caps are created or not); ``**kw`` can be used to specify ``mask`` which is passed to :obj:`woo.dem.Facet.make`, but *masks* will override this, if given.</span>
<span class="sd">:returns: List of :obj:`particles &lt;woo.dem.Particle&gt;` building up the cylinder. Caps (if any) are always at the beginning of the list, triangulated perimeter is at the end.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cylLen</span><span class="o">=</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">/</span><span class="n">cylLen</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ax is&#39;</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">axOri</span><span class="o">=</span><span class="n">Quaternion</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span> <span class="n">axOri</span><span class="o">.</span><span class="n">setFromTwoVectors</span><span class="p">(</span><span class="n">Vector3</span><span class="o">.</span><span class="n">UnitX</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">thetas</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">div</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">yyzz</span><span class="o">=</span><span class="p">[</span><span class="n">Vector2</span><span class="p">(</span><span class="n">radius</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">),</span><span class="n">radius</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">))</span> <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">axDiv</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">circum</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">radius</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">axDiv</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">axDiv</span><span class="p">)</span><span class="o">*</span><span class="n">cylLen</span><span class="o">/</span><span class="p">(</span><span class="n">circum</span><span class="o">/</span><span class="n">div</span><span class="p">))</span>
    <span class="n">xx</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cylLen</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">axDiv</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">xxyyzz</span><span class="o">=</span><span class="p">[[</span><span class="n">A</span><span class="o">+</span><span class="n">axOri</span><span class="o">*</span><span class="n">Vector3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">yz</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">yz</span> <span class="ow">in</span> <span class="n">yyzz</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xx</span><span class="p">]</span>
    <span class="c1"># add caps, if needed; the points will be merged automatically in sweptPolylines2gtsSurface via threshold</span>
    <span class="n">caps</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">wallCaps</span><span class="p">:</span>
        <span class="c1"># determine cylinder orientation</span>
        <span class="n">cAx</span><span class="o">=-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
             <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vector3</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">i</span><span class="p">)))</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">1e-6</span><span class="p">):</span> <span class="n">cAx</span><span class="o">=</span><span class="n">i</span>
        <span class="k">if</span> <span class="n">cAx</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;With wallCaps=True, cylinder axis must be aligned with some global axis&quot;</span><span class="p">)</span>
        <span class="n">sign</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">copysign</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Vector3</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">cAx</span><span class="p">))))</span> <span class="c1"># reversed axis</span>
        <span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="o">=</span><span class="p">((</span><span class="n">cAx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">),((</span><span class="n">cAx</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">glAB</span><span class="o">=</span><span class="n">AlignedBox2</span><span class="p">((</span><span class="n">A</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span><span class="n">A</span><span class="p">[</span><span class="n">a2</span><span class="p">]</span><span class="o">-</span><span class="n">radius</span><span class="p">),(</span><span class="n">A</span><span class="p">[</span><span class="n">a1</span><span class="p">]</span><span class="o">+</span><span class="n">radius</span><span class="p">,</span><span class="n">A</span><span class="p">[</span><span class="n">a2</span><span class="p">]</span><span class="o">+</span><span class="n">radius</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">capA</span><span class="p">:</span>
            <span class="n">caps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">wall</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">cAx</span><span class="p">,</span><span class="n">sense</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span><span class="n">glAB</span><span class="o">=</span><span class="n">glAB</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">angVel</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">caps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">angVel</span><span class="p">[</span><span class="n">cAx</span><span class="p">]</span><span class="o">=</span><span class="n">sign</span><span class="o">*</span><span class="n">angVel</span>
        <span class="k">if</span> <span class="n">capB</span><span class="p">:</span>
            <span class="n">caps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">wall</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">cAx</span><span class="p">,</span><span class="n">sense</span><span class="o">=-</span><span class="n">sign</span><span class="p">,</span><span class="n">glAB</span><span class="o">=</span><span class="n">glAB</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">angVel</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">caps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">angVel</span><span class="p">[</span><span class="n">cAx</span><span class="p">]</span><span class="o">=</span><span class="n">sign</span><span class="o">*</span><span class="n">angVel</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># add as triangulation</span>
        <span class="k">if</span> <span class="n">capA</span><span class="p">:</span> <span class="n">xxyyzz</span><span class="o">=</span><span class="p">[[</span><span class="n">A</span><span class="o">+</span><span class="n">Vector3</span><span class="o">.</span><span class="n">Zero</span> <span class="k">for</span> <span class="n">yz</span> <span class="ow">in</span> <span class="n">yyzz</span><span class="p">]]</span><span class="o">+</span><span class="n">xxyyzz</span>
        <span class="k">if</span> <span class="n">capB</span><span class="p">:</span> <span class="n">xxyyzz</span><span class="o">+=</span><span class="p">[[</span><span class="n">B</span><span class="o">+</span><span class="n">Vector3</span><span class="o">.</span><span class="n">Zero</span> <span class="k">for</span> <span class="n">yz</span> <span class="ow">in</span> <span class="n">yyzz</span><span class="p">]]</span>
    <span class="n">ff</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">gtsSurface2Facets</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">sweptPolylines2gtsSurface</span><span class="p">(</span><span class="n">xxyyzz</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span><span class="n">cylLen</span><span class="p">)</span><span class="o">*</span><span class="mf">1e-4</span><span class="p">),</span><span class="n">fixed</span><span class="o">=</span><span class="n">fixed</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">angVel</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> 
        <span class="k">if</span> <span class="ow">not</span> <span class="n">realRot</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">fakeVel</span><span class="o">=-</span><span class="n">radius</span><span class="o">*</span><span class="n">angVel</span><span class="o">*</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">getNormal</span><span class="p">()</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qq</span><span class="o">=</span><span class="n">Quaternion</span><span class="p">();</span> <span class="n">qq</span><span class="o">.</span><span class="n">setFromTwoVectors</span><span class="p">(</span><span class="n">Vector3</span><span class="o">.</span><span class="n">UnitZ</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
            <span class="n">orbit</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">StableCircularOrbit</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">A</span><span class="p">,</span><span class="n">ori</span><span class="o">=</span><span class="n">qq</span><span class="p">),</span><span class="n">omega</span><span class="o">=</span><span class="n">angVel</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="n">n</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">impose</span><span class="o">=</span><span class="n">orbit</span>
    <span class="c1"># override masks of particles</span>
    <span class="k">if</span> <span class="n">masks</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">mask</span><span class="o">=</span><span class="n">masks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># set the cylinder as if everywhere first</span>
        <span class="k">if</span> <span class="n">wallCaps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">capA</span><span class="p">:</span> <span class="n">caps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mask</span><span class="o">=</span><span class="n">masks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">capB</span><span class="p">:</span> <span class="n">caps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">masks</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">capA</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">pos</span><span class="o">==</span><span class="n">A</span><span class="p">]):</span> <span class="n">f</span><span class="o">.</span><span class="n">mask</span><span class="o">=</span><span class="n">masks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">capB</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ff</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">nodes</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">pos</span><span class="o">==</span><span class="n">B</span><span class="p">]):</span> <span class="n">f</span><span class="o">.</span><span class="n">mask</span><span class="o">=</span><span class="n">masks</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">caps</span><span class="o">+</span><span class="n">ff</span></div>

<div class="viewcode-block" id="ribbedMill"><a class="viewcode-back" href="../../woo.triangulated.html#woo.triangulated.ribbedMill">[docs]</a><span class="k">def</span> <span class="nf">ribbedMill</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">radius</span><span class="p">,</span><span class="n">majNum</span><span class="p">,</span><span class="n">majHt</span><span class="p">,</span><span class="n">majTipAngle</span><span class="p">,</span><span class="n">minNum</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">minHt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">minTipAngle</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">div</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">:param majNum: number of major ribs (parallel with rotation axis)</span>
<span class="sd">:param majHt: height of major ribs</span>
<span class="sd">:param majTipAngle: angle on the major rib tip</span>
<span class="sd">:param minNum: number of minor ribs (around the cylinder, in plane perpendicular to the rotation axis)</span>
<span class="sd">:param minHt: height of minor ribs</span>
<span class="sd">:param minTipAngle: angle on the minor rib tip</span>
<span class="sd">:returns: tuple ``[particles],centralNode``, which can be directly used in ``S.dem.par.addClumped(*woo.triangulated.ribbedMill(...))``. ``centralNode`` is local coordinate system positioned in ``A`` and of which :math:`x`-axis is rotation axis of the mill. Assigning ``dem.angVel=centralNode.ori*(0,0,w)`` will make the mill rotate around the axis with the angular velocity ``w``. ``centralNode`` has automatically ClumpData assigned, with :obj:`~woo.dem.DemData.blocked` equal to ``xyzXYZ`.</span>
<span class="sd">&#39;&#39;&#39;</span>
    <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="o">=</span><span class="n">Vector3</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">Vector3</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="n">cylLen</span><span class="o">=</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">=</span><span class="p">(</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">/</span><span class="n">cylLen</span>
    <span class="n">axOri</span><span class="o">=</span><span class="n">Quaternion</span><span class="p">();</span> <span class="n">axOri</span><span class="o">.</span><span class="n">setFromTwoVectors</span><span class="p">(</span><span class="n">Vector3</span><span class="o">.</span><span class="n">UnitZ</span><span class="p">,</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">cs</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">A</span><span class="p">,</span><span class="n">ori</span><span class="o">=</span><span class="n">axOri</span><span class="p">,</span><span class="n">dem</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">ClumpData</span><span class="p">(</span><span class="n">blocked</span><span class="o">=</span><span class="s1">&#39;xyzXYZ&#39;</span><span class="p">))</span>
    <span class="n">locCyl</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">z</span><span class="p">:</span> <span class="n">cs</span><span class="o">.</span><span class="n">loc2glob</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">cyl2cart</span><span class="p">(</span><span class="n">Vector3</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">z</span><span class="p">)))</span>
    <span class="n">locCart</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">loc2glob</span>

    <span class="n">majPeri</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">majHt</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">majTipAngle</span><span class="p">)</span> <span class="c1"># length of a maj on the perimeter of the mill</span>
    <span class="n">majAngle</span><span class="o">=</span><span class="n">majPeri</span><span class="o">/</span><span class="n">radius</span> <span class="c1"># angle of one rib from the axis of the mill</span>
    <span class="n">interMajAngle</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">majNum</span>
    <span class="n">interMajNum</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">div</span><span class="o">*</span><span class="mf">1.</span><span class="o">/</span><span class="n">majNum</span><span class="p">)))</span>
    <span class="n">majRad</span><span class="o">=</span><span class="n">radius</span><span class="o">-</span><span class="n">majHt</span>
    <span class="n">pts</span><span class="o">=</span><span class="p">[];</span> <span class="n">thMin</span><span class="o">=</span><span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">majNum</span><span class="p">):</span>
        <span class="n">thMin</span><span class="o">+=</span><span class="n">interMajAngle</span>
        <span class="n">thMax</span><span class="o">=</span><span class="n">thMin</span><span class="o">+</span><span class="n">interMajAngle</span><span class="o">-</span><span class="n">majAngle</span>
        <span class="n">thTip</span><span class="o">=</span><span class="n">thMax</span><span class="o">+.</span><span class="mi">5</span><span class="o">*</span><span class="n">majAngle</span>
        <span class="c1"># the circular parts spanning from thMin to thMax</span>
        <span class="n">thetas</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">thMin</span><span class="p">,</span><span class="n">thMax</span><span class="p">,</span><span class="n">interMajNum</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">th0</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span> <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locCyl</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span><span class="n">th0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># tip of the major rib</span>
        <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locCyl</span><span class="p">(</span><span class="n">majRad</span><span class="p">,</span><span class="n">thTip</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="c1"># close the curve</span>
    <span class="n">pts</span><span class="o">+=</span><span class="p">[</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># make the second contour, just shifted by millDp; ppts contains both</span>
    <span class="n">ppts</span><span class="o">=</span><span class="p">[</span><span class="n">pts</span><span class="p">,[</span><span class="n">p</span><span class="o">+</span><span class="n">axOri</span><span class="o">*</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">cylLen</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">]]</span>
    <span class="n">millPar</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">gtsSurface2Facets</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">sweptPolylines2gtsSurface</span><span class="p">(</span><span class="n">ppts</span><span class="p">,</span><span class="n">threshold</span><span class="o">=.</span><span class="mi">001</span><span class="o">*</span><span class="n">majHt</span><span class="p">),</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="c1"># minor ribs</span>
    <span class="n">minPar</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">minNum</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">minHalfWd</span><span class="o">=</span><span class="n">minHt</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">minTipAngle</span><span class="p">)</span>
        <span class="n">thetas</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">majNum</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">xx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">cylLen</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">minNum</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
            <span class="n">pts</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">th</span> <span class="ow">in</span> <span class="n">thetas</span><span class="p">:</span>
                <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">locCyl</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">xx</span><span class="o">-.</span><span class="mi">5</span><span class="o">*</span><span class="n">minHalfWd</span><span class="p">),</span><span class="n">locCyl</span><span class="p">(</span><span class="n">radius</span><span class="o">-</span><span class="n">minHt</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">xx</span><span class="p">),</span><span class="n">locCyl</span><span class="p">(</span><span class="n">radius</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">xx</span><span class="o">+.</span><span class="mi">5</span><span class="o">*</span><span class="n">minHalfWd</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">i</span><span class="o">==</span><span class="n">minNum</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span> <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">))</span>
            <span class="c1"># one rib is done all around</span>
            <span class="n">minPar</span><span class="o">+=</span><span class="n">woo</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">gtsSurface2Facets</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">sweptPolylines2gtsSurface</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.001</span><span class="o">*</span><span class="n">minHt</span><span class="p">),</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">millPar</span><span class="o">+</span><span class="n">minPar</span><span class="p">,</span><span class="n">cs</span></div>

<div class="viewcode-block" id="quadrilateral"><a class="viewcode-back" href="../../woo.triangulated.html#woo.triangulated.quadrilateral">[docs]</a><span class="k">def</span> <span class="nf">quadrilateral</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">div</span><span class="o">=</span><span class="n">Vector2i</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="s1">&#39;Return triangulated `quadrilateral &lt;http://en.wikipedia.org/wiki/Quadrilateral&gt;`__ (or a `skew quadrilateral &lt;http://en.wikipedia.org/wiki/Skew_polygon&gt;`__), when points are not co-planar), where division size is at most *size* (absolute length) or *div* (number of subdivisions in the AB--CD and AC--BD directions).&#39;</span>
    <span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="o">=</span><span class="n">Vector3</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">Vector3</span><span class="p">(</span><span class="n">B</span><span class="p">),</span><span class="n">Vector3</span><span class="p">(</span><span class="n">C</span><span class="p">),</span><span class="n">Vector3</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">div</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">div</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Both components of div must be positive&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;only one of *div* or *size* may be given (not both)&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="o">=</span><span class="nb">min</span><span class="p">((</span><span class="n">A</span><span class="o">-</span><span class="n">C</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">(),(</span><span class="n">D</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">()),</span><span class="nb">min</span><span class="p">((</span><span class="n">A</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">(),(</span><span class="n">C</span><span class="o">-</span><span class="n">D</span><span class="p">)</span><span class="o">.</span><span class="n">norm</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">size</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span> <span class="n">div</span><span class="o">=</span><span class="n">Vector2i</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">l1</span><span class="o">/</span><span class="n">size</span><span class="p">))),</span><span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">l2</span><span class="o">/</span><span class="n">size</span><span class="p">))))</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">div</span><span class="o">=</span><span class="n">Vector2i</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">AB</span><span class="p">,</span><span class="n">AC</span><span class="p">,</span><span class="n">CD</span><span class="p">,</span><span class="n">BD</span><span class="o">=</span><span class="n">B</span><span class="o">-</span><span class="n">A</span><span class="p">,</span><span class="n">C</span><span class="o">-</span><span class="n">A</span><span class="p">,</span><span class="n">D</span><span class="o">-</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="o">-</span><span class="n">B</span>
    <span class="n">aabb</span><span class="p">,</span><span class="n">aacc</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">div</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">div</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pts</span><span class="o">=</span><span class="p">[[</span><span class="n">A</span><span class="o">+</span><span class="n">ac</span><span class="o">*</span><span class="n">AC</span><span class="o">+</span><span class="n">ab</span><span class="o">*</span><span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="n">ac</span><span class="o">*</span><span class="n">BD</span><span class="o">-</span><span class="p">(</span><span class="n">A</span><span class="o">+</span><span class="n">ac</span><span class="o">*</span><span class="n">AC</span><span class="p">))</span> <span class="k">for</span> <span class="n">ac</span> <span class="ow">in</span> <span class="n">aacc</span><span class="p">]</span> <span class="k">for</span> <span class="n">ab</span> <span class="ow">in</span> <span class="n">aabb</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">woo</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">gtsSurface2Facets</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">sweptPolylines2gtsSurface</span><span class="p">(</span><span class="n">pts</span><span class="p">),</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="box"><a class="viewcode-back" href="../../woo.triangulated.html#woo.triangulated.box">[docs]</a><span class="k">def</span> <span class="nf">box</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span><span class="n">center</span><span class="p">,</span><span class="n">which</span><span class="o">=</span><span class="n">Vector6i</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Return box created from facets. ``**kw`` args are passed to :obj:`woo.dem.Facet.make`. If facets have thickness, node masses and inertia will be computed automatically.</span>

<span class="sd">:param Vector3 dim: dimensions along x, y, z axes;</span>
<span class="sd">:param center: a :obj:`minieigen:Vector3` (box aligned with global axes) or :obj:`woo.core.Node` (local coordinate system) giving the center of the box;</span>
<span class="sd">:param Vector6i which: select walls which are to be included (all by default); the order is -x, -y, -z, +x, +y, +z. Thuus, e.g., to make box without top, say ``which=(1,1,1,1,1,0)``.</span>
<span class="sd">&#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">center</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">):</span> <span class="n">c</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">c</span><span class="o">=</span><span class="n">center</span>
    <span class="n">nn</span><span class="o">=</span><span class="p">[</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">loc2glob</span><span class="p">(</span><span class="n">Vector3</span><span class="p">(</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">sgn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">sgn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="o">.</span><span class="mi">5</span><span class="o">*</span><span class="n">sgn</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">dim</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span> <span class="k">for</span> <span class="n">sgn</span> <span class="ow">in</span> <span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))]</span>
    <span class="c1"># vertex indices of faces of unit cube (two facets per face)</span>
    <span class="n">indices</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
    <span class="c1"># mapping face to which (first two are -z, and so on)</span>
    <span class="n">whichMap</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">ff</span><span class="o">=</span><span class="p">[</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">Facet</span><span class="o">.</span><span class="n">make</span><span class="p">((</span><span class="n">nn</span><span class="p">[</span><span class="n">ii</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">nn</span><span class="p">[</span><span class="n">ii</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">nn</span><span class="p">[</span><span class="n">ii</span><span class="p">[</span><span class="mi">2</span><span class="p">]]),</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ii</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="nb">bool</span><span class="p">(</span><span class="n">which</span><span class="p">[</span><span class="n">whichMap</span><span class="p">[</span><span class="n">i</span><span class="p">]])]</span>
    <span class="k">if</span> <span class="n">ff</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">halfThick</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="c1"># it is harmless to run those on nodes which are unused due to `which`</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nn</span><span class="p">:</span> <span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">DemData</span><span class="o">.</span><span class="n">setOriMassInertia</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ff</span></div>


<div class="viewcode-block" id="sweep2d"><a class="viewcode-back" href="../../woo.triangulated.html#woo.triangulated.sweep2d">[docs]</a><span class="k">def</span> <span class="nf">sweep2d</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="n">zz</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">fakeVel</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">halfThick</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">shift</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">shorten</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Build surface by perpendicularly sweeping list of 2d points along the 3rd axis (in global/local coordinates).</span>

<span class="sd">    :param pts: list of :obj:`minieigen:Vector2` containing :math:`xy` coordinates of points in local axes. If the point is ``(nan,nan)`` or ``None``, the line is split at this point. If the point contains ``(nan,i)``, then it refers to ``i``-th point which has been constructed up to now: positive number from the beginning of the line, negative from the end.</span>
<span class="sd">    :param zz: tuple or :obj:`minieigen:Vector2` containing ``(z0,z1)`` coordinates for all points.</span>
<span class="sd">    :param node: optional instance of :obj:`woo.core.Node` defining local coordinate system; if not given, global coordinates are used.</span>
<span class="sd">    :param float fakeVel: assign :obj:`~woo.dem.Facet.fakeVel` to facets, in the sweeping direction at every face</span>
<span class="sd">    :param halfThick: if given and *halfThick* is ``True``, shift points so that *pts* give points of the outer surface (and nodes are shifted inwards); in this case, the ordering of pts is important.</span>
<span class="sd">    :param shift: activate point shifting, in conjunction with *halfThick*;</span>
<span class="sd">    :param shorten: move endpoints away from the endpoint (along the segment) by *halfThick*;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="n">isnan</span>
    <span class="n">nan</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">)</span>
    <span class="n">nn</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># list of nodes</span>
    <span class="n">ff</span><span class="o">=</span><span class="p">[]</span> <span class="c1"># list of facets</span>
    <span class="n">stacks</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">stacks</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;len(zz)stacks must be greater than 1 (not </span><span class="si">{stacks}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="c1"># tell whether pp[i] is an invalid point (beginning, ending, nan, None)</span>
    <span class="k">def</span> <span class="nf">invalid</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span><span class="o">&gt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">maxAbsCoeff</span><span class="p">())</span>
    <span class="c1"># same as invalid, but point with a single NaN is a point (referring another node)</span>
    <span class="k">def</span> <span class="nf">notPt</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span><span class="o">&gt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span> <span class="ow">or</span> <span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">isnan</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># reference point: NaN and some number</span>
    <span class="k">def</span> <span class="nf">refPt</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="k">return</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isnan</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">isnan</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># return nodes referred from point</span>
    <span class="k">def</span> <span class="nf">refNodes</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">negRefAdd</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">refPt</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
        <span class="n">j</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">pp</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">j</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span> <span class="n">j</span><span class="o">+=</span><span class="n">negRefAdd</span>
        <span class="k">return</span> <span class="n">nn</span><span class="p">[</span><span class="n">stacks</span><span class="o">*</span><span class="n">j</span><span class="p">:</span><span class="n">stacks</span><span class="o">*</span><span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">angleBetween</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
        <span class="c1"># http://stackoverflow.com/a/2663678/761090</span>
        <span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">a2</span><span class="o">&gt;</span><span class="n">a1</span><span class="o">+</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span> <span class="n">a2</span><span class="o">-=</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">elif</span> <span class="n">a2</span><span class="o">&lt;</span><span class="n">a1</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span> <span class="n">a2</span><span class="o">-=</span><span class="mi">2</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="n">a2</span><span class="o">-</span><span class="n">a1</span>
    <span class="n">pts</span><span class="o">=</span><span class="p">[</span><span class="n">Vector2</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Vector2</span><span class="p">(</span><span class="n">nan</span><span class="p">,</span><span class="n">nan</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">]</span> <span class="c1"># fix types, so that all vector methods work</span>

    <span class="k">if</span> <span class="n">shift</span> <span class="ow">and</span> <span class="n">halfThick</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">pts2</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">def</span> <span class="nf">perp</span><span class="p">(</span><span class="n">v</span><span class="p">):</span> <span class="k">return</span> <span class="n">Vector2</span><span class="p">(</span><span class="o">-</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">invalid</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
                <span class="n">pts2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c1"># copy the same invalid on</span>
                <span class="k">continue</span>
            <span class="c1"># find average perpendicular vector at that point</span>
            <span class="n">begPt</span><span class="p">,</span><span class="n">endPt</span><span class="o">=</span><span class="n">invalid</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">invalid</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">begPt</span> <span class="ow">and</span> <span class="n">endPt</span><span class="p">:</span>
                <span class="n">pts2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">continue</span> <span class="c1"># might be reffering elsewhere... raise ValueError(&quot;Point at %d is not connected to any other.&quot;%i)</span>
            <span class="k">if</span> <span class="n">begPt</span><span class="p">:</span> <span class="n">pts2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">perp</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">halfThick</span><span class="o">+</span><span class="p">((</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span><span class="o">*</span><span class="n">halfThick</span> <span class="k">if</span> <span class="n">shorten</span> <span class="k">else</span> <span class="n">Vector2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">endPt</span><span class="p">:</span> <span class="n">pts2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">perp</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">halfThick</span><span class="o">+</span><span class="p">((</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span><span class="o">*</span><span class="n">halfThick</span> <span class="k">if</span> <span class="n">shorten</span> <span class="k">else</span> <span class="n">Vector2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="o">=</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">normalized</span><span class="p">(),(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
                <span class="n">a</span><span class="o">=</span><span class="n">angleBetween</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span>
                <span class="n">d</span><span class="o">=</span><span class="p">(</span><span class="n">halfThick</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="mf">2.</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">e1</span><span class="o">+</span><span class="n">e2</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
                <span class="n">pts2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pts</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">d</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">pts2</span><span class="o">=</span><span class="n">pts</span>
    <span class="c1"># if len(zz)!=2: raise ValueError(&#39;len(zz) must be 2 (not %d)&#39;%len(zz))</span>
    <span class="n">cs</span><span class="o">=</span><span class="p">(</span><span class="n">node</span> <span class="k">if</span> <span class="n">node</span> <span class="k">else</span> <span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">ori</span><span class="o">=</span><span class="n">Quaternion</span><span class="o">.</span><span class="n">Identity</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">pts2</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">notPt</span><span class="p">(</span><span class="n">pts2</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="k">continue</span>
        <span class="n">begPt</span><span class="p">,</span><span class="n">endPt</span><span class="o">=</span><span class="n">notPt</span><span class="p">(</span><span class="n">pts2</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">notPt</span><span class="p">(</span><span class="n">pts2</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#print i,begPt,endPt</span>
        <span class="k">if</span> <span class="n">refPt</span><span class="p">(</span><span class="n">pts2</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
            <span class="n">left</span><span class="o">=</span><span class="n">refNodes</span><span class="p">(</span><span class="n">pts2</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">negRefAdd</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">negRefAdd</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nn</span><span class="o">+=</span><span class="p">[</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="n">cs</span><span class="o">.</span><span class="n">loc2glob</span><span class="p">((</span><span class="n">pts2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pts2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="p">)),</span><span class="n">dem</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">DemData</span><span class="p">(</span><span class="n">blocked</span><span class="o">=</span><span class="s1">&#39;xyzXYZ&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">zz</span><span class="p">]</span>
            <span class="n">left</span><span class="o">=</span><span class="n">nn</span><span class="p">[</span><span class="o">-</span><span class="n">stacks</span><span class="p">:]</span>
            <span class="c1"># C,D=nn[-2],nn[-1]</span>
            <span class="c1"># this added two nodes, so references counting backwards must go one further</span>
            <span class="n">negRefAdd</span><span class="o">=-</span><span class="mi">1</span>
        <span class="c1"># beginning point does nothing else, all other add the last segment</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">begPt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">refPt</span><span class="p">(</span><span class="n">pts2</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">right</span><span class="o">=</span><span class="n">refNodes</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">negRefAdd</span><span class="o">=</span><span class="n">negRefAdd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">right</span><span class="o">=</span><span class="n">nn</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">stacks</span><span class="p">:</span><span class="o">-</span><span class="n">stacks</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">nn</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">4</span> <span class="c1"># there must be at least 4 points already</span>
            <span class="c1"># fakeVel</span>
            <span class="k">if</span> <span class="n">fakeVel</span><span class="o">==</span><span class="mf">0.</span><span class="p">:</span> <span class="n">fv</span><span class="o">=</span><span class="n">Vector3</span><span class="o">.</span><span class="n">Zero</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">fv</span><span class="o">=</span><span class="p">(</span><span class="n">right</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="o">-</span><span class="n">left</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span><span class="o">*</span><span class="n">fakeVel</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">stacks</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">verts</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]),(</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">right</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">left</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])]:</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">Facet</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span><span class="n">halfThick</span><span class="o">=</span><span class="n">halfThick</span><span class="p">,</span><span class="n">fakeVel</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
            <span class="c1">#ff+=[</span>
            <span class="c1">#    woo.dem.Facet.make((A,C,D),halfThick=halfThick,fakeVel=fv,**kw),</span>
            <span class="c1">#    woo.dem.Facet.make((A,D,B),halfThick=halfThick,fakeVel=fv,**kw)</span>
            <span class="c1">#]</span>
    <span class="k">return</span> <span class="n">ff</span></div>



<span class="kn">import</span> <span class="nn">woo.pyderived</span>
<div class="viewcode-block" id="MeshImport"><a class="viewcode-back" href="../../woo.triangulated.html#woo.triangulated.MeshImport">[docs]</a><span class="k">class</span> <span class="nc">MeshImport</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">pyderived</span><span class="o">.</span><span class="n">PyWooObject</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;User interface for importing meshes from external files , so that all import parameters are kept together. Currently supported formats are:</span>

<span class="sd">    * STL: both ascii and binary formats; :obj:`tagged` not supported (meaningless)</span>
<span class="sd">    * nastran: subset, ``GRID`` and ``CTRIA3`` tags are recognized, others ignored; :obj:`tagged` is supported, nodal numbers are preserved.</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">_classTrait</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">_PAT</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">pyderived</span><span class="o">.</span><span class="n">PyAttrTrait</span>
    <span class="n">_attrTraits</span><span class="o">=</span><span class="p">[</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="s1">&#39;file&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">existingFilename</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Mesh file to be imported (STL)&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;preScale&#39;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Scaling, applied before other transformations.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span><span class="s1">&#39;node&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Node defining local coordinate system for importing (already :obj:`prescaled &lt;preScale&gt;`) mesh; if not given, global coordinate system is assumed.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;halfThick&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;mm&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Half thickness (:obj:`woo.dem.Facet.halfThick`) assigned to all created facets. If zero, don</span><span class="se">\&#39;</span><span class="s1">t assign :obj:`~woo.dem.Facet.halfThick`.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="n">Vector3</span><span class="p">,</span><span class="s1">&#39;fakeVel&#39;</span><span class="p">,</span><span class="n">Vector3</span><span class="o">.</span><span class="n">Zero</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;m/s&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;:obj:`Fake surface velocity &lt;woo.dem.Facet.fakeVel&gt;` set (as-is) on all imported facets; if ``(0,0,0)`` (default), nothing is set.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;tessMaxBox&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;mm&#39;</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Some importers (STL) can tesselated triangles so that their bounding box dimension does not exceed :obj:`tessMaxBox`. If non-positive, no tesselation will be done.&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span><span class="s1">&#39;tagged&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Use :obj:`woo.dem.DemDataTagged` to keep information about node number at input; this is only supported for some formats, and exception will be raise if used with format not supporting it }e.g. STL does not store vertices)&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;color&#39;</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="s1">&#39;nan&#39;</span><span class="p">),</span><span class="s1">&#39;Pass resulting particle color (scalar) when importing; only effective for formats which support it (STL). *nan* disables&#39;</span><span class="p">),</span>
    <span class="p">]</span>
<div class="viewcode-block" id="MeshImport.__new__"><a class="viewcode-back" href="../../woo.triangulated.html#woo.triangulated.MeshImport.__new__">[docs]</a>    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">=</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wooPyInit</span><span class="p">(</span><span class="n">MeshImport</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wooPyInit</span><span class="p">(</span><span class="n">MeshImport</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<div class="viewcode-block" id="MeshImport.doImport"><a class="viewcode-back" href="../../woo.triangulated.html#woo.triangulated.MeshImport.doImport">[docs]</a>    <span class="k">def</span> <span class="nf">doImport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mat</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">DemField</span><span class="o">.</span><span class="n">defaultStaticMask</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="s1">&#39;Do the actual import. Nastern: ``**kw`` is passed to :obj:`woo.dem.Facet.make`. STL: some values from ``**kw`` used (``color``) and passed to :obj:`woo.utils.importSTL &lt;woo._utils2.importSTL&gt;`.&#39;</span>
        <span class="n">fmt</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.stl&#39;</span><span class="p">):</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;stl&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.nas&#39;</span><span class="p">):</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;nastran&#39;</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unknown mesh file extension (must be .stl, .nas).&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;thickness&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Use MeshImport.halfThick attribute to set thickness, instead of passing MeshImport.doImport(thickness=...).&#39;</span><span class="p">)</span>

        <span class="c1"># called after import for each format, before returning</span>
        <span class="k">def</span> <span class="nf">applyFakeVel</span><span class="p">(</span><span class="n">tri</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fakeVel</span><span class="o">!=</span><span class="n">Vector3</span><span class="o">.</span><span class="n">Zero</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tri</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">fakeVel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fakeVel</span>

        <span class="k">if</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;stl&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagged</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;MeshImport.tagged: not supported (meaningless) with STL format.&#39;</span><span class="p">)</span>
            <span class="n">kw2</span><span class="o">=</span><span class="p">{}</span>
            <span class="c1"># extract recognized values from **kw</span>
            <span class="k">for</span> <span class="n">ex</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">ex</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span> <span class="n">kw2</span><span class="p">[</span><span class="n">ex</span><span class="p">]</span><span class="o">=</span><span class="n">kw</span><span class="p">[</span><span class="n">ex</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">math</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">):</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Using user-defined color </span><span class="si">%g</span><span class="s1"> for STL import&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
                <span class="n">kw2</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span>
            <span class="n">tri</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">importSTL</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">preScale</span><span class="p">,</span><span class="n">shift</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">pos</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="k">else</span> <span class="n">Vector3</span><span class="o">.</span><span class="n">Zero</span><span class="p">),</span><span class="n">ori</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">ori</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="k">else</span> <span class="n">Quaternion</span><span class="o">.</span><span class="n">Identity</span><span class="p">),</span><span class="n">maxBox</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tessMaxBox</span><span class="p">,</span><span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">halfThick</span><span class="p">,</span><span class="o">**</span><span class="n">kw2</span><span class="p">)</span>
            <span class="n">applyFakeVel</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tri</span>
        <span class="k">elif</span> <span class="n">fmt</span><span class="o">==</span><span class="s1">&#39;nastran&#39;</span><span class="p">:</span>
            <span class="n">nodeMap</span><span class="o">=</span><span class="p">{}</span> <span class="c1"># mapping of nodes numbers (tags) to Node objects</span>
            <span class="n">tri</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">lineno</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">infile</span><span class="p">):</span>
                    <span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># chomp newline</span>
                    <span class="k">if</span> <span class="s1">&#39;$&#39;</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span> <span class="n">l</span><span class="o">=</span><span class="n">l</span><span class="p">[:</span><span class="n">l</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)]</span> <span class="c1"># discard comments</span>
                    <span class="k">if</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;GRID &#39;</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># if l[45]==&#39;-&#39;: l=l[:45]+&#39;   &#39;</span>
                            <span class="n">tag</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">preScale</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">32</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">preScale</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">40</span><span class="p">]),</span><span class="bp">self</span><span class="o">.</span><span class="n">preScale</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">48</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: Error reading line&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span><span class="n">lineno</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                            <span class="k">raise</span>
                        <span class="n">dta</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">DemDataTagged</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tagged</span> <span class="k">else</span> <span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">DemData</span><span class="p">()</span>
                        <span class="n">nodeMap</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">dem</span><span class="o">=</span><span class="n">dta</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">loc2glob</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)))</span>
                    <span class="k">elif</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;CTRIA3 &#39;</span><span class="p">):</span>
                        <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">24</span><span class="p">:</span><span class="mi">32</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">32</span><span class="p">:</span><span class="mi">40</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">48</span><span class="p">])</span>
                        <span class="n">tri</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">Facet</span><span class="o">.</span><span class="n">make</span><span class="p">([</span><span class="n">nodeMap</span><span class="p">[</span><span class="n">a</span><span class="p">],</span><span class="n">nodeMap</span><span class="p">[</span><span class="n">b</span><span class="p">],</span><span class="n">nodeMap</span><span class="p">[</span><span class="n">c</span><span class="p">]],</span><span class="n">mat</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span><span class="n">halfThick</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">halfThick</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">))</span>
                    <span class="c1"># lines we know to ignore</span>
                    <span class="k">elif</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;BEGIN BULK&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;PSHELL&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;MAT&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">l</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ENDDATA&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span> <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">:</span><span class="si">%d</span><span class="s1">: unparsed line skipped: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">,</span><span class="n">lineno</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="p">)</span>
            <span class="n">applyFakeVel</span><span class="p">(</span><span class="n">tri</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tri</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Programming error: unhandled value fmt==&quot;</span><span class="si">%s</span><span class="s1">&quot;.&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fmt</span><span class="p">)))</span></div></div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../index.html">Woo 1.0+rev1-git-1ff39f7 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">woo.triangulated</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 20122022, Vclav milauer &lt;eu@doxos.eu&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>
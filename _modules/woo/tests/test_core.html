


<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>woo.tests.test_core &#8212; Woo 1.0+rev1-git-f169989 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>

    
    
     
        <script src="../../../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../../../_static/cloud.base.js"></script>
    

    
     
        <script src="../../../_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="../../../_static/woo-favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">Woo 1.0+rev1-git-f169989 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../tests.html" accesskey="U">woo.tests</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">woo.tests.test_core</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for woo.tests.test_core</h1><div class="highlight"><pre>
<span></span><span class="c1"># encoding: utf-8</span>
<span class="c1"># 2009 © Václav Šmilauer &lt;eudoxos@arcig.cz&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Core functionality (Scene in c++), such as accessing bodies, materials, interactions. Specific functionality tests should go to engines.py or elsewhere, not here.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">woo</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">minieigen</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">woo</span>
<span class="kn">from</span> <span class="nn">woo</span> <span class="k">import</span> <span class="n">utils</span>
<span class="kn">from</span> <span class="nn">woo.core</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">woo.dem</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">woo.pre</span> <span class="k">import</span> <span class="o">*</span>
<span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">woo.sparc</span> <span class="k">import</span> <span class="o">*</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">woo.gl</span> <span class="k">import</span> <span class="o">*</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">woo.voro</span> <span class="k">import</span> <span class="o">*</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">woo.cld</span> <span class="k">import</span> <span class="o">*</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
<span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">woo.qt</span> <span class="k">import</span> <span class="o">*</span>
<span class="k">except</span><span class="p">:</span> <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">woo</span>
<span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">usesApi</span><span class="o">=</span><span class="mi">10104</span>

<span class="c1">## TODO tests</span>
<div class="viewcode-block" id="TestInteractions"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestInteractions">[docs]</a><span class="k">class</span> <span class="nc">TestInteractions</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="TestForce"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestForce">[docs]</a><span class="k">class</span> <span class="nc">TestForce</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span> <span class="k">pass</span></div>
<div class="viewcode-block" id="TestTags"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestTags">[docs]</a><span class="k">class</span> <span class="nc">TestTags</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span> <span class="k">pass</span> </div>



<div class="viewcode-block" id="TestScene"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestScene">[docs]</a><span class="k">class</span> <span class="nc">TestScene</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestScene.setUp"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestScene.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">()</span></div></div>
    <span class="c1">#def _testTags(self):</span>
    <span class="c1">#    &#39;Core: Scene.tags are str (not unicode) objects&#39;</span>
    <span class="c1">#    S=self.scene</span>
    <span class="c1">#    S.tags[&#39;str&#39;]=&#39;asdfasd&#39;</span>
    <span class="c1">#    S.tags[&#39;uni&#39;]=u&#39;→ Σ&#39;</span>
    <span class="c1">#    self.assertTrue(type(S.tags[&#39;str&#39;]==unicode))</span>
    <span class="c1">#    def tagError(S): S.tags[&#39;error&#39;]=234</span>
    <span class="c1">#    self.assertTrue(type(S.tags[&#39;uni&#39;]==unicode))</span>
    <span class="c1">#    self.assertRaises(TypeError,lambda: tagError(S))</span>

<div class="viewcode-block" id="TestObjectInstantiation"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation">[docs]</a><span class="k">class</span> <span class="nc">TestObjectInstantiation</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestObjectInstantiation.setUp"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">()</span>
        <span class="c1"># usually disabled and will be removed completely</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="p">,</span><span class="s1">&#39;WooTestClassStatic&#39;</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClassStatic</span><span class="p">()</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testClassCtors"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testClassCtors">[docs]</a>    <span class="k">def</span> <span class="nf">testClassCtors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: correct types are instantiated&quot;</span>
        <span class="c1"># correct instances created with Foo() syntax</span>
        <span class="kn">import</span> <span class="nn">woo.system</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">woo</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">childClasses</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">=</span><span class="n">r</span><span class="p">();</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">==</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;Failed for &#39;</span><span class="o">+</span><span class="n">r</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testRootDerivedCtors_attrs_few"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testRootDerivedCtors_attrs_few">[docs]</a>    <span class="k">def</span> <span class="nf">testRootDerivedCtors_attrs_few</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: class ctor&#39;s attributes&quot;</span>
        <span class="c1"># attributes passed when using the Foo(attr1=value1,attr2=value2) syntax</span>
        <span class="n">gm</span><span class="o">=</span><span class="n">Shape</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="mf">1.</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">gm</span><span class="o">.</span><span class="n">color</span><span class="o">==</span><span class="mf">1.</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestObjectInstantiation.testDeepcopy"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testDeepcopy">[docs]</a>    <span class="k">def</span> <span class="nf">testDeepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Object.deepcopy&#39;</span>
        <span class="n">t</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">()</span>
        <span class="n">t</span><span class="o">.</span><span class="n">mass</span><span class="o">=</span><span class="mf">0.</span>
        <span class="n">t2</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mass</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">mass</span><span class="o">==</span><span class="mf">1.0</span> <span class="ow">and</span> <span class="n">t</span><span class="o">.</span><span class="n">mass</span><span class="o">==</span><span class="mf">0.</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testPyRunnerCtor"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testPyRunnerCtor">[docs]</a>    <span class="k">def</span> <span class="nf">testPyRunnerCtor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: PyRunner with positional args&quot;</span>
        <span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">p3</span><span class="o">=</span><span class="n">PyRunner</span><span class="p">(</span><span class="s1">&#39;one&#39;</span><span class="p">),</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;two&#39;</span><span class="p">),</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;three&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">p1</span><span class="o">.</span><span class="n">command</span><span class="p">,</span><span class="n">p1</span><span class="o">.</span><span class="n">stepPeriod</span><span class="p">),(</span><span class="s1">&#39;one&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">p2</span><span class="o">.</span><span class="n">command</span><span class="p">,</span><span class="n">p2</span><span class="o">.</span><span class="n">stepPeriod</span><span class="p">),(</span><span class="s1">&#39;two&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">p3</span><span class="o">.</span><span class="n">command</span><span class="p">,</span><span class="n">p3</span><span class="o">.</span><span class="n">stepPeriod</span><span class="p">),(</span><span class="s1">&#39;three&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">PyRunner</span><span class="p">(</span><span class="mi">111</span><span class="p">))</span> <span class="c1"># must be a string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">PyRunner</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span><span class="mi">456</span><span class="p">))</span> <span class="c1"># must be string and number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">PyRunner</span><span class="p">(</span><span class="s1">&#39;ab&#39;</span><span class="p">,</span><span class="s1">&#39;cd&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testDispatcherCtor"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testDispatcherCtor">[docs]</a>    <span class="k">def</span> <span class="nf">testDispatcherCtor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: dispatcher ctors with functors&quot;</span>
        <span class="c1"># dispatchers take list of their functors in the ctor</span>
        <span class="c1"># same functors are collapsed in one</span>
        <span class="n">cld1</span><span class="o">=</span><span class="n">LawDispatcher</span><span class="p">([</span><span class="n">Law2_L6Geom_FrictPhys_IdealElPl</span><span class="p">(),</span><span class="n">Law2_L6Geom_FrictPhys_IdealElPl</span><span class="p">()]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cld1</span><span class="o">.</span><span class="n">functors</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># two different make two different</span>
        <span class="n">cld2</span><span class="o">=</span><span class="n">LawDispatcher</span><span class="p">([</span><span class="n">Law2_L6Geom_FrictPhys_IdealElPl</span><span class="p">(),</span><span class="n">Law2_L6Geom_FrictPhys_LinEl6</span><span class="p">()]);</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cld2</span><span class="o">.</span><span class="n">functors</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testContactLoopCtor"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testContactLoopCtor">[docs]</a>    <span class="k">def</span> <span class="nf">testContactLoopCtor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: ContactLoop special ctor&quot;</span>
        <span class="c1"># ContactLoop takes 3 lists</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">ContactLoop</span><span class="p">([</span><span class="n">Cg2_Facet_Sphere_L6Geom</span><span class="p">(),</span><span class="n">Cg2_Sphere_Sphere_L6Geom</span><span class="p">()],[</span><span class="n">Cp2_FrictMat_FrictPhys</span><span class="p">()],[</span><span class="n">Law2_L6Geom_FrictPhys_IdealElPl</span><span class="p">()],)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">geoDisp</span><span class="o">.</span><span class="n">functors</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">geoDisp</span><span class="o">.</span><span class="vm">__class__</span><span class="o">==</span><span class="n">CGeomDispatcher</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">phyDisp</span><span class="o">.</span><span class="n">functors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">==</span><span class="n">Cp2_FrictMat_FrictPhys</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">id</span><span class="o">.</span><span class="n">lawDisp</span><span class="o">.</span><span class="n">functors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">==</span><span class="n">Law2_L6Geom_FrictPhys_IdealElPl</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testParallelEngineCtor"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testParallelEngineCtor">[docs]</a>    <span class="k">def</span> <span class="nf">testParallelEngineCtor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: ParallelEngine special ctor&quot;</span>
        <span class="n">pe</span><span class="o">=</span><span class="n">ParallelEngine</span><span class="p">([</span><span class="n">InsertionSortCollider</span><span class="p">(),[</span><span class="n">BoundDispatcher</span><span class="p">(),</span><span class="n">ForceResetter</span><span class="p">()]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">pe</span><span class="o">.</span><span class="n">slaves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">==</span><span class="n">InsertionSortCollider</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pe</span><span class="o">.</span><span class="n">slaves</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">pe</span><span class="o">.</span><span class="n">slaves</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pe</span><span class="o">.</span><span class="n">slaves</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span></div>
    <span class="c1">##        </span>
    <span class="c1">## testing incorrect operations that should raise exceptions</span>
    <span class="c1">##</span>
<div class="viewcode-block" id="TestObjectInstantiation.testWrongFunctorType"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testWrongFunctorType">[docs]</a>    <span class="k">def</span> <span class="nf">testWrongFunctorType</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: dispatcher and functor type mismatch is detected&quot;</span>
        <span class="c1"># dispatchers accept only correct functors</span>
        <span class="c1"># pybind11: RuntimeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">TypeError</span><span class="p">,</span><span class="ne">RuntimeError</span><span class="p">),</span><span class="k">lambda</span><span class="p">:</span> <span class="n">LawDispatcher</span><span class="p">([</span><span class="n">Bo1_Sphere_Aabb</span><span class="p">()]))</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testInvalidAttr"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testInvalidAttr">[docs]</a>    <span class="k">def</span> <span class="nf">testInvalidAttr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: invalid attribute access raises AttributeError&#39;</span>
        <span class="c1"># accessing invalid attributes raises AttributeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Sphere</span><span class="p">(</span><span class="n">attributeThatDoesntExist</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">Sphere</span><span class="p">()</span><span class="o">.</span><span class="n">attributeThatDoesntExist</span><span class="p">)</span></div>
    <span class="c1">###</span>
    <span class="c1">### shared ownership semantics</span>
    <span class="c1">###</span>
<div class="viewcode-block" id="TestObjectInstantiation.testShared"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testShared">[docs]</a>    <span class="k">def</span> <span class="nf">testShared</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: shared_ptr really shared&quot;</span>
        <span class="n">m</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">defaultMaterial</span><span class="p">()</span>
        <span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">sphere</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="n">m</span><span class="p">),</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">sphere</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
        <span class="n">s1</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">young</span><span class="o">=</span><span class="mi">2342333</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">young</span><span class="o">==</span><span class="n">s2</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">young</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testSharedAfterReload"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testSharedAfterReload">[docs]</a>    <span class="k">def</span> <span class="nf">testSharedAfterReload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Core: shared_ptr preserved when saving/loading&quot;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">Scene</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">DemField</span><span class="p">()])</span>
        <span class="n">m</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">defaultMaterial</span><span class="p">()</span>
        <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">sphere</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="n">m</span><span class="p">),</span><span class="n">woo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">sphere</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">2</span><span class="p">,</span><span class="n">mat</span><span class="o">=</span><span class="n">m</span><span class="p">)])</span>
        <span class="n">S</span><span class="o">.</span><span class="n">saveTmp</span><span class="p">(</span><span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">S</span><span class="o">=</span><span class="n">Scene</span><span class="o">.</span><span class="n">loadTmp</span><span class="p">()</span>
        <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">young</span><span class="o">=</span><span class="mi">9087438484</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">young</span><span class="o">==</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">young</span><span class="p">)</span></div>
    <span class="c1">##</span>
    <span class="c1">## attribute flags</span>
    <span class="c1">##</span>
<div class="viewcode-block" id="TestObjectInstantiation.testNoSave"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testNoSave">[docs]</a>    <span class="k">def</span> <span class="nf">testNoSave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Attr::noSave&#39;</span>
        <span class="c1"># update bound of the particle</span>
        <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="n">i0</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">noSaveAttr</span>
        <span class="n">t</span><span class="o">.</span><span class="n">noSaveAttr</span><span class="o">=</span><span class="n">i0</span><span class="o">+</span><span class="mi">10</span>
        <span class="n">t</span><span class="o">.</span><span class="n">saveTmp</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="n">t2</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="o">.</span><span class="n">loadTmp</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
        <span class="c1"># loaded copy has the default value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">noSaveAttr</span><span class="o">==</span><span class="n">i0</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testNoSave_static"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testNoSave_static">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="p">,</span><span class="s1">&#39;WooTestClassStatic&#39;</span><span class="p">),</span><span class="s1">&#39;Built without static attrs&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">testNoSave_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Attr::noSave (static)&#39;</span>
        <span class="n">ts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">noSave</span><span class="o">=</span><span class="mi">344</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">=</span><span class="s1">&#39;one&#39;</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">saveTmp</span><span class="p">(</span><span class="s1">&#39;ts&#39;</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">noSave</span><span class="o">=</span><span class="mi">123</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">noSave</span><span class="o">==</span><span class="mi">123</span><span class="p">)</span>
        <span class="n">ts2</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClassStatic</span><span class="o">.</span><span class="n">loadTmp</span><span class="p">(</span><span class="s1">&#39;ts&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ts2</span><span class="o">.</span><span class="n">noSave</span><span class="o">==</span><span class="mi">123</span><span class="p">)</span>        <span class="c1"># was not saved</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ts2</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;one&#39;</span><span class="p">)</span> <span class="c1"># was saved</span>
        <span class="c1"># since it is static, self.ts is changed as well now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="n">ts2</span><span class="o">.</span><span class="n">namedEnum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">namedEnum</span><span class="p">)</span><span class="o">==</span><span class="nb">id</span><span class="p">(</span><span class="n">ts2</span><span class="o">.</span><span class="n">namedEnum</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestObjectInstantiation.testReadonly"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testReadonly">[docs]</a>    <span class="k">def</span> <span class="nf">testReadonly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Attr::readonly&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">meaning42</span><span class="o">==</span><span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;meaning42&#39;</span><span class="p">,</span><span class="mi">43</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testReaonly_static"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testReaonly_static">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="p">,</span><span class="s1">&#39;WooTestClassStatic&#39;</span><span class="p">),</span><span class="s1">&#39;Built without static attrs&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">testReaonly_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Attr::readonly (static)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span><span class="s1">&#39;readonly&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span></div>
    
<div class="viewcode-block" id="TestObjectInstantiation.testTriggerPostLoad"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testTriggerPostLoad">[docs]</a>    <span class="k">def</span> <span class="nf">testTriggerPostLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: postLoad &amp; Attr::triggerPostLoad&#39;</span>
        <span class="n">WTC</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span>
        <span class="c1"># stage right after construction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">postLoadStage</span><span class="p">,</span><span class="n">WTC</span><span class="o">.</span><span class="n">postLoad_ctor</span><span class="p">)</span>
        <span class="n">baz0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">baz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">foo_incBaz</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># assign whatever, baz should be incremented</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">baz</span><span class="p">,</span><span class="n">baz0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">postLoadStage</span><span class="p">,</span><span class="n">WTC</span><span class="o">.</span><span class="n">postLoad_foo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">foo_incBaz</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">baz</span><span class="p">,</span><span class="n">baz0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">bar_zeroBaz</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># assign to reset baz</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">baz</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">postLoadStage</span><span class="p">,</span><span class="n">WTC</span><span class="o">.</span><span class="n">postLoad_bar</span><span class="p">)</span>
        <span class="c1"># assign to baz to test postLoad again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">baz</span><span class="o">=-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">postLoadStage</span><span class="o">==</span><span class="n">WTC</span><span class="o">.</span><span class="n">postLoad_baz</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestObjectInstantiation.testUnicodeStrConverter"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testUnicodeStrConverter">[docs]</a>    <span class="k">def</span> <span class="nf">testUnicodeStrConverter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: std::string attributes can be assigned unicode string&#39;</span>
        <span class="n">t</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">(</span><span class="n">strVar</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">strVar</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;abc&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">strVar</span><span class="o">==</span><span class="s1">&#39;abc&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testNamedEnum"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testNamedEnum">[docs]</a>    <span class="k">def</span> <span class="nf">testNamedEnum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Attr::namedEnum&#39;</span>
        <span class="n">t</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;namedEnum&#39;</span><span class="p">,</span><span class="s1">&#39;nonsense&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;namedEnum&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;namedEnum&#39;</span><span class="p">,[]))</span>
        <span class="n">t</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">=</span><span class="s1">&#39;zero&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
        <span class="c1"># try with unicode string</span>
        <span class="n">t</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">=</span><span class="sa">u</span><span class="s1">&#39;zero&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">=</span><span class="s1">&#39;nothing&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
        <span class="c1"># ctor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">(</span><span class="n">namedEnum</span><span class="o">=</span><span class="s1">&#39;nonsense&#39;</span><span class="p">))</span>
        <span class="n">tt</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">(</span><span class="n">namedEnum</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;one&#39;</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testNamedEnum_static"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testNamedEnum_static">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="p">,</span><span class="s1">&#39;WooTestClassStatic&#39;</span><span class="p">),</span><span class="s1">&#39;Built without static attrs&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">testNamedEnum_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Attr::namedEnum (static)&#39;</span>
        <span class="n">ts</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="s1">&#39;namedEnum&#39;</span><span class="p">,</span><span class="s1">&#39;nonsense&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="s1">&#39;namedEnum&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span><span class="s1">&#39;namedEnum&#39;</span><span class="p">,[]))</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">=</span><span class="s1">&#39;zero&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
        <span class="n">ts</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">=-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;minus one&#39;</span><span class="p">)</span>
        <span class="c1"># test passing it in the ctor</span>
        <span class="n">tt</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">(</span><span class="n">namedEnum</span><span class="o">=</span><span class="s1">&#39;NULL&#39;</span><span class="p">)</span> <span class="c1"># use the alternative name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;zero&#39;</span><span class="p">)</span>
        <span class="n">tt</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">(</span><span class="n">namedEnum</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># use number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">namedEnum</span><span class="o">==</span><span class="s1">&#39;one&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TestObjectInstantiation.testBits"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testBits">[docs]</a>    <span class="k">def</span> <span class="nf">testBits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: AttrTrait.bits accessors&#39;</span> 
        <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span>
        <span class="c1"># flags and bits read-write</span>
        <span class="n">t</span><span class="o">.</span><span class="n">bits</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">bit0</span><span class="p">)</span>
        <span class="n">t</span><span class="o">.</span><span class="n">bit2</span><span class="o">=</span><span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">bits</span><span class="o">==</span><span class="mi">5</span><span class="p">)</span>
        <span class="c1"># flags read-only, bits midifiable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;bitsRw&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">t</span><span class="o">.</span><span class="n">bit2rw</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">t</span><span class="o">.</span><span class="n">bit3rw</span><span class="o">=</span><span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">bitsRw</span><span class="o">==</span><span class="mi">12</span><span class="p">)</span>
        <span class="c1"># both flags and bits read-only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;bitsRo&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;bit1ro&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">bitsRo</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">((</span><span class="n">t</span><span class="o">.</span><span class="n">bit0ro</span><span class="p">,</span><span class="n">t</span><span class="o">.</span><span class="n">bit1ro</span><span class="p">,</span><span class="n">t</span><span class="o">.</span><span class="n">bit2ro</span><span class="p">)</span><span class="o">==</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="kc">True</span><span class="p">,</span><span class="kc">False</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testDeprecated"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testDeprecated">[docs]</a>    <span class="k">def</span> <span class="nf">testDeprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: AttrTrait.deprecated raises exception on access&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;deprecatedAttr&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;deprecatedAttr&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span></div>
    <span class="c1">## not (yet) supported for static attributes</span>
    <span class="c1"># def testBits_static(self):</span>

<div class="viewcode-block" id="TestObjectInstantiation.testHidden"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testHidden">[docs]</a>    <span class="k">def</span> <span class="nf">testHidden</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Attr::hidden&#39;</span>
        <span class="c1"># hidden attributes are not wrapped in python at all</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;hiddenAttr&#39;</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testHidden_static"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testHidden_static">[docs]</a>    <span class="nd">@unittest</span><span class="o">.</span><span class="n">skipIf</span><span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="p">,</span><span class="s1">&#39;WooTestClassStatic&#39;</span><span class="p">),</span><span class="s1">&#39;Built without static attrs&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">testHidden_static</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: Attr::hidden (static)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ts</span><span class="p">,</span><span class="s1">&#39;hidden&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestObjectInstantiation.testNotifyDead"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testNotifyDead">[docs]</a>    <span class="k">def</span> <span class="nf">testNotifyDead</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: PeriodicEngine::notifyDead&#39;</span>
        <span class="n">e</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestPeriodicEngine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">deadCounter</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">prev</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">deadCounter</span>
        <span class="n">e</span><span class="o">.</span><span class="n">dead</span><span class="o">=</span><span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">deadCounter</span><span class="o">&gt;</span><span class="n">prev</span><span class="p">)</span> <span class="c1"># ideally, this should be 1, not 4 by now!!</span>
        <span class="n">prev</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">deadCounter</span>
        <span class="n">e</span><span class="o">.</span><span class="n">dead</span><span class="o">=</span><span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">deadCounter</span><span class="o">&gt;</span><span class="n">prev</span><span class="p">)</span>
        <span class="n">prev</span><span class="o">=</span><span class="n">e</span><span class="o">.</span><span class="n">deadCounter</span>
        <span class="n">e</span><span class="o">.</span><span class="n">dead</span><span class="o">=</span><span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">deadCounter</span><span class="o">&gt;</span><span class="n">prev</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestObjectInstantiation.testNodeDataCtorAssign"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestObjectInstantiation.testNodeDataCtorAssign">[docs]</a>    <span class="k">def</span> <span class="nf">testNodeDataCtorAssign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Core: assign node data using shorthands in the ctor&#39;</span>
        <span class="n">n</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span><span class="n">dem</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">DemData</span><span class="p">(</span><span class="n">mass</span><span class="o">=</span><span class="mi">100</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">mass</span><span class="o">==</span><span class="mi">100</span><span class="p">)</span>
        <span class="c1"># pybind11: RuntimeError</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">((</span><span class="ne">TypeError</span><span class="p">,</span><span class="ne">RuntimeError</span><span class="p">),</span><span class="k">lambda</span><span class="p">:</span> <span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">dem</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;gl&#39;</span> <span class="ow">in</span> <span class="n">woo</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">features</span><span class="p">:</span>
            <span class="c1"># type mismatch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">dem</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">gl</span><span class="o">.</span><span class="n">GlData</span><span class="p">()))</span></div></div>

<div class="viewcode-block" id="TestLoop"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop">[docs]</a><span class="k">class</span> <span class="nc">TestLoop</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestLoop.setUp"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">DemField</span><span class="p">()]</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">dt</span><span class="o">=</span><span class="mf">1e-8</span></div>
<div class="viewcode-block" id="TestLoop.testSubstepping"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testSubstepping">[docs]</a>    <span class="k">def</span> <span class="nf">testSubstepping</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: substepping&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;pass&#39;</span><span class="p">),</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;pass&#39;</span><span class="p">),</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;pass&#39;</span><span class="p">)]</span>
        <span class="c1"># value outside the loop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">subStep</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># O.subStep is meaningful when substepping</span>
        <span class="n">S</span><span class="o">.</span><span class="n">subStepping</span><span class="o">=</span><span class="kc">True</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">subStep</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">subStep</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># when substepping is turned off in the middle of the loop, the next step finishes the loop</span>
        <span class="n">S</span><span class="o">.</span><span class="n">subStepping</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">subStep</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># subStep==0 inside the loop without substepping</span>
        <span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;if scene.subStep!=0: raise RuntimeError(&quot;scene.subStep!=0 inside the loop with Scene.subStepping==False!&quot;)&#39;</span><span class="p">)]</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">()</span></div>
<div class="viewcode-block" id="TestLoop.testEnginesModificationInsideLoop"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testEnginesModificationInsideLoop">[docs]</a>    <span class="k">def</span> <span class="nf">testEnginesModificationInsideLoop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: Scene.engines can be modified inside the loop transparently.&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span>
            <span class="n">PyRunner</span><span class="p">(</span><span class="n">stepPeriod</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">command</span><span class="o">=</span><span class="s1">&#39;from woo.core import *; from woo.dem import *; scene.engines=[ForceResetter(),ForceResetter(),Leapfrog(reset=False)]&#39;</span><span class="p">),</span> <span class="c1"># change engines here</span>
            <span class="n">ForceResetter</span><span class="p">()</span> <span class="c1"># useless engine</span>
        <span class="p">]</span>
        <span class="n">S</span><span class="o">.</span><span class="n">subStepping</span><span class="o">=</span><span class="kc">True</span>
        <span class="c1"># run prologue and the first engine, which modifies O.engines</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">();</span> <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">subStep</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># gives modified engine sequence transparently</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">_nextEngines</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">_currEngines</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">();</span> <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">();</span> <span class="c1"># run the 2nd ForceResetter, and epilogue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">subStep</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># start the next step, nextEngines should replace engines automatically</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">subStep</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">_nextEngines</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">_currEngines</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestLoop.testDead"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testDead">[docs]</a>    <span class="k">def</span> <span class="nf">testDead</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: dead engines are not run&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;pass&#39;</span><span class="p">,</span><span class="n">dead</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">nDone</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestLoop.testPausedContext"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testPausedContext">[docs]</a>    <span class="k">def</span> <span class="nf">testPausedContext</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: &quot;with Scene.paused()&quot; context manager&#39;</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">S</span><span class="o">.</span><span class="n">engines</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">S</span><span class="o">.</span><span class="n">paused</span><span class="p">():</span>
            <span class="n">i</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">step</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">S</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="c1"># check there was no advance during those .1 secs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">running</span><span class="p">)</span> <span class="c1"># running should return true nevertheless</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="o">.</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="n">S</span><span class="o">.</span><span class="n">step</span><span class="p">)</span> <span class="c1"># check we run during those .1 secs again</span>
        <span class="n">S</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>
<div class="viewcode-block" id="TestLoop.testNoneEngine"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testNoneEngine">[docs]</a>    <span class="k">def</span> <span class="nf">testNoneEngine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: None engine raises exception.&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="s1">&#39;engines&#39;</span><span class="p">,[</span><span class="n">ContactLoop</span><span class="p">(),</span><span class="kc">None</span><span class="p">,</span><span class="n">ContactLoop</span><span class="p">()]))</span></div>
<div class="viewcode-block" id="TestLoop.testStopAtStep"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testStopAtStep">[docs]</a>    <span class="k">def</span> <span class="nf">testStopAtStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: S.stopAtStep and S.run(steps=...)&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">stopAtStep</span><span class="o">=</span><span class="mi">100</span> <span class="c1"># absolute value</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">step</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># relative value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">step</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestLoop.testStopAtTime"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testStopAtTime">[docs]</a>    <span class="k">def</span> <span class="nf">testStopAtTime</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: S.stopAtTime and S.run(time=...)&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">stopAtTime</span><span class="o">=</span><span class="mf">1.0001</span> <span class="c1"># absolute value</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="mf">1.001</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">time</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># relative value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="mf">1.501</span><span class="p">,</span><span class="n">delta</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestLoop.testStopAtHook"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testStopAtHook">[docs]</a>    <span class="k">def</span> <span class="nf">testStopAtHook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: S.stopAtHook&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
        <span class="c1"># both of them should trivver stopAtHook            </span>
        <span class="n">S</span><span class="o">.</span><span class="n">stopAtTime</span><span class="o">=</span><span class="mf">10e-3</span>
        <span class="n">S</span><span class="o">.</span><span class="n">stopAtStep</span><span class="o">=</span><span class="mi">1000</span>
        <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">_setWritable</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">stopAtHook</span><span class="o">=</span><span class="s1">&#39;S.lab.a+=1&#39;</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># stopAtTime applies first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># stopAtStep applies now</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="o">.</span><span class="n">a</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestLoop.testWait"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testWait">[docs]</a>    <span class="k">def</span> <span class="nf">testWait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: Scene.wait() returns only after the current step finished&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;import time; S.stop(); time.sleep(.3); S.lab.aa=True&#39;</span><span class="p">)])</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">lab</span><span class="p">,</span><span class="s1">&#39;aa&#39;</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestLoop.testWaitTimeout"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testWaitTimeout">[docs]</a>    <span class="k">def</span> <span class="nf">testWaitTimeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: Scene.wait(timeout=...)&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;import time; time.sleep(1)&#39;</span><span class="p">)])</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">S</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timeout</span><span class="o">=.</span><span class="mi">01</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestLoop.testWaitException"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testWaitException">[docs]</a>    <span class="k">def</span> <span class="nf">testWaitException</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: Scene.wait() returns on exception&#39;</span>
        <span class="c1"># silence loggers</span>
        <span class="n">ll</span><span class="o">=</span><span class="nb">dict</span><span class="p">([(</span><span class="n">l</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">level</span><span class="p">(</span><span class="n">l</span><span class="p">))</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;Engine&#39;</span><span class="p">,</span><span class="s1">&#39;Scene&#39;</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">ll</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">woo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">OFF</span><span class="p">)</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;raise ValueError(&quot;Some error error&quot;)&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">lev</span> <span class="ow">in</span> <span class="n">ll</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">woo</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">lev</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestLoop.testWaitForScenes"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestLoop.testWaitForScenes">[docs]</a>    <span class="k">def</span> <span class="nf">testWaitForScenes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Loop: Master.waitForScenes correctly handles reassignment of the master scene&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">dt</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span><span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="n">PyRunner</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;import time; S.stop(); time.sleep(.3); woo.master.scene=woo.core.Scene(dt=1e-4,engines=[woo.core.PyRunner(1,&quot;S.stop()&quot;)])&#39;</span><span class="p">)])</span>
        <span class="n">S</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">waitForScenes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">dt</span><span class="o">==</span><span class="mf">1e-4</span><span class="p">)</span> <span class="c1"># check master scene is the second one</span></div></div>




        
<div class="viewcode-block" id="TestIO"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestIO">[docs]</a><span class="k">class</span> <span class="nc">TestIO</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestIO.testSaveAllClasses"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestIO.testSaveAllClasses">[docs]</a>    <span class="k">def</span> <span class="nf">testSaveAllClasses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;I/O: All classes can be saved and loaded with boost::serialization&#39;</span>
        <span class="kn">import</span> <span class="nn">woo.system</span>
        <span class="n">failed</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">woo</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">childClasses</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="p">):</span>
            <span class="n">t</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">t</span><span class="o">.</span><span class="n">any</span><span class="o">=</span><span class="n">c</span><span class="p">()</span>
                <span class="n">t</span><span class="o">.</span><span class="n">saveTmp</span><span class="p">(</span><span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">loadTmpAny</span><span class="p">()</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span><span class="ne">ValueError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="s1">&#39;*&#39;</span><span class="o">+</span><span class="s1">&#39; error with class &#39;</span><span class="o">+</span><span class="n">c</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
                <span class="n">failed</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="n">failed</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">failed</span><span class="p">);</span> <span class="n">failed</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">failed</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Failed classes were: &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">failed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;Failed classes were: &#39;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">failed</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="mi">80</span><span class="o">*</span><span class="s1">&#39;#&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestContact"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestContact">[docs]</a><span class="k">class</span> <span class="nc">TestContact</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestContact.setUp"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestContact.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">DemField</span><span class="p">()],</span><span class="n">engines</span><span class="o">=</span><span class="n">DemField</span><span class="o">.</span><span class="n">minimalEngines</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">Sphere</span><span class="o">.</span><span class="n">make</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="mf">1.1</span><span class="p">))</span>
        <span class="n">S</span><span class="o">.</span><span class="n">one</span><span class="p">()</span></div>
<div class="viewcode-block" id="TestContact.testForceSign"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestContact.testForceSign">[docs]</a>    <span class="k">def</span> <span class="nf">testForceSign</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Contact: forceSign&#39;</span>
        <span class="n">S</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span>
        <span class="n">c45</span><span class="o">=</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">con</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">inc</span><span class="o">=</span><span class="p">(</span><span class="n">c45</span><span class="o">.</span><span class="n">id1</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">c45</span><span class="o">.</span><span class="n">forceSign</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">==</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">inc</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">c45</span><span class="o">.</span><span class="n">forceSign</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">==</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">inc</span> <span class="k">else</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">c45</span><span class="o">.</span><span class="n">forceSign</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">c45</span><span class="o">.</span><span class="n">forceSign</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">==</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">inc</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">c45</span><span class="o">.</span><span class="n">forceSign</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span><span class="o">==</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">inc</span> <span class="k">else</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">c45</span><span class="o">.</span><span class="n">forceSign</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span></div></div>


<div class="viewcode-block" id="TestParticles"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestParticles">[docs]</a><span class="k">class</span> <span class="nc">TestParticles</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestParticles.setUp"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestParticles.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">DemField</span><span class="p">()]</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">=</span><span class="mi">100</span>
        <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">utils</span><span class="o">.</span><span class="n">sphere</span><span class="p">([</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()],</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)])</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span></div>
<div class="viewcode-block" id="TestParticles.testIterate"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestParticles.testIterate">[docs]</a>    <span class="k">def</span> <span class="nf">testIterate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Particles: iteration&quot;</span>
        <span class="n">counted</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">:</span> <span class="n">counted</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">counted</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestParticles.testLen"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestParticles.testLen">[docs]</a>    <span class="k">def</span> <span class="nf">testLen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Particles: len(S.dem.par)&quot;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestParticles.testRemove"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestParticles.testRemove">[docs]</a>    <span class="k">def</span> <span class="nf">testRemove</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Particles: acessing removed particles raises IndexError&quot;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>
<div class="viewcode-block" id="TestParticles.testRemoveShrink"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestParticles.testRemoveShrink">[docs]</a>    <span class="k">def</span> <span class="nf">testRemoveShrink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Particles: removing particles shrinks storage size&quot;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">)</span><span class="o">==</span><span class="n">i</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestParticles.testNegativeIndex"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestParticles.testNegativeIndex">[docs]</a>    <span class="k">def</span> <span class="nf">testNegativeIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Particles: negative index counts backwards (like python sequences).&quot;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>
<div class="viewcode-block" id="TestParticles.testRemovedIterate"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestParticles.testRemovedIterate">[docs]</a>    <span class="k">def</span> <span class="nf">testRemovedIterate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Particles: iterator silently skips erased particles&quot;</span>
        <span class="n">S</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">scene</span>
        <span class="n">removed</span><span class="p">,</span><span class="n">counted</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span> <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="nb">id</span><span class="p">);</span> <span class="n">removed</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">S</span><span class="o">.</span><span class="n">dem</span><span class="o">.</span><span class="n">par</span><span class="p">:</span> <span class="n">counted</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">counted</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">count</span><span class="o">-</span><span class="n">removed</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TestArrayAccu"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestArrayAccu">[docs]</a><span class="k">class</span> <span class="nc">TestArrayAccu</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestArrayAccu.setUp"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestArrayAccu.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">WooTestClass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">numThreads</span></div>
    <span class="c1">#def testRead(self):</span>
    <span class="c1">#    &#39;OpenMP array accu: implicit conversion to python list&#39;</span>
    <span class="c1">#    print(self.t.aaccu)</span>
<div class="viewcode-block" id="TestArrayAccu.testResize"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestArrayAccu.testResize">[docs]</a>    <span class="k">def</span> <span class="nf">testResize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;OpenMP array accu: resizing&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuRaw</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># initial zero size</span>
        <span class="k">for</span> <span class="n">sz</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">33</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuRaw</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">)]</span>
            <span class="n">r</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuRaw</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sz</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">)</span>  <span class="c1"># first thread is assigned the value</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">n</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># other threads are reset</span></div>
<div class="viewcode-block" id="TestArrayAccu.testPreserveResize"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestArrayAccu.testPreserveResize">[docs]</a>    <span class="k">def</span> <span class="nf">testPreserveResize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;OpenMP array accu: preserve old data on resize&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuRaw</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuWriteThreads</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="mi">2</span><span class="p">])</span> <span class="c1"># write whatever to index 2: resizes, but should preserve 0,1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuRaw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuRaw</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestArrayAccu.testThreadWrite"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestArrayAccu.testThreadWrite">[docs]</a>    <span class="k">def</span> <span class="nf">testThreadWrite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;OpenMP array accu: concurrent writes&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuWriteThreads</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuRaw</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">i</span><span class="p">)</span> <span class="c1"># each thread has written its own index</span></div>
<div class="viewcode-block" id="TestArrayAccu.testPyConverter"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestArrayAccu.testPyConverter">[docs]</a>    <span class="k">def</span> <span class="nf">testPyConverter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;OpenMP array accu: to-python conversion&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccuRaw</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aaccu</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span></div></div>

<div class="viewcode-block" id="_TestPyClass"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core._TestPyClass">[docs]</a><span class="k">class</span> <span class="nc">_TestPyClass</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">pyderived</span><span class="o">.</span><span class="n">PyWooObject</span><span class="p">):</span>
    <span class="s1">&#39;Sample pure-python class integrated into woo (mainly used with preprocessors), for use with :obj:`TestPyDerived`.&#39;</span>
    <span class="n">PAT</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">pyderived</span><span class="o">.</span><span class="n">PyAttrTrait</span>
    <span class="n">_attrTraits</span><span class="o">=</span><span class="p">[</span>
        <span class="n">PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;aF&#39;</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="s1">&#39;float attr&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">([</span><span class="nb">float</span><span class="p">,],</span><span class="s1">&#39;aFF&#39;</span><span class="p">,[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.</span><span class="p">],</span><span class="s1">&#39;list of floats attr&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">(</span><span class="n">Vector2</span><span class="p">,</span><span class="s1">&#39;aV2&#39;</span><span class="p">,(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">),</span><span class="s1">&#39;vector2 attr&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">([</span><span class="n">Vector2</span><span class="p">,],</span><span class="s1">&#39;aVV2&#39;</span><span class="p">,[(</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">),(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">)],</span><span class="s1">&#39;list of vector2 attr&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span><span class="s1">&#39;aNode&#39;</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="s1">&#39;node attr&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span><span class="s1">&#39;aNodeNone&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;node attr, uninitialized&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">([</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">,],</span><span class="s1">&#39;aNNode&#39;</span><span class="p">,[</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)),</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))],</span><span class="s1">&#39;List of nodes&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="s1">&#39;aF_trigger&#39;</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="n">triggerPostLoad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Float triggering postLoad, copying its value to aF&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="s1">&#39;postLoadCounter&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;counter for postLoad (readonly). Incremented by 1 after construction, incremented by 10 when assigning to aF_trigger.&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="s1">&#39;deprecAttr&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">deprecated</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;deprecated, here should be the explanation.&#39;</span><span class="p">),</span>
        <span class="n">PAT</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="s1">&#39;sChoice&#39;</span><span class="p">,</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">choice</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="s1">&#39;bb&#39;</span><span class="p">,</span><span class="s1">&#39;cc&#39;</span><span class="p">],</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;String choice attribute&#39;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="k">def</span> <span class="nf">postLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">I</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">I</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postLoadCounter</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">I</span><span class="o">==</span><span class="s1">&#39;aF_trigger&#39;</span><span class="p">:</span>
            <span class="c1"># print &#39;postLoad / aF_trigger&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">postLoadCounter</span><span class="o">+=</span><span class="mi">10</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aF</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aF_trigger</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">+</span><span class="s1">&#39;.postLoad called with unknown attribute id </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">I</span><span class="p">)</span>
<div class="viewcode-block" id="_TestPyClass.__new__"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core._TestPyClass.__new__">[docs]</a>    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">=</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wooPyInit</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wooPyInit</span><span class="p">(</span><span class="n">_TestPyClass</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Object</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>

<div class="viewcode-block" id="_TestPyClass2"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core._TestPyClass2">[docs]</a><span class="k">class</span> <span class="nc">_TestPyClass2</span><span class="p">(</span><span class="n">_TestPyClass</span><span class="p">):</span>
    <span class="s1">&#39;Python class deriving from python base class (which in turn derives from c++).&#39;</span>
    <span class="n">_PAT</span><span class="o">=</span><span class="n">woo</span><span class="o">.</span><span class="n">pyderived</span><span class="o">.</span><span class="n">PyAttrTrait</span>
    <span class="k">def</span> <span class="nf">postLoad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">I</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">I</span><span class="o">==</span><span class="s1">&#39;f2&#39;</span> <span class="ow">or</span> <span class="n">I</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">f2counter</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> <span class="nb">super</span><span class="p">(</span><span class="n">_TestPyClass2</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">postLoad</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
    <span class="n">_attrTraits</span><span class="o">=</span><span class="p">[</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="s1">&#39;f2&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">triggerPostLoad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Float attr in derived class&#39;</span><span class="p">),</span>
        <span class="n">_PAT</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="s1">&#39;f2counter&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Count how many times was f2 manipulated (to test triggerPostLoad in class with python parent)&#39;</span><span class="p">),</span>
    <span class="p">]</span>
<div class="viewcode-block" id="_TestPyClass2.__new__"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core._TestPyClass2.__new__">[docs]</a>    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">=</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">klass</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wooPyInit</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="n">_TestPyClass</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">_TestPyClass</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wooPyInit</span><span class="p">(</span><span class="n">_TestPyClass2</span><span class="p">,</span><span class="n">_TestPyClass</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestPyDerived"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived">[docs]</a><span class="k">class</span> <span class="nc">TestPyDerived</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">woo.pyderived</span><span class="o">,</span> <span class="nn">woo.core</span>
<div class="viewcode-block" id="TestPyDerived.setUp"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.setUp">[docs]</a>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">=</span><span class="n">_TestPyClass</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">=</span><span class="n">_TestPyClass2</span><span class="p">()</span></div>
    <span class="k">def</span> <span class="nf">testTrigger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: postLoad triggers&#39;</span>
        <span class="c1"># print &#39;postLoadCounter after ctor:&#39;,self.t.postLoadCounter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">postLoadCounter</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF_trigger</span><span class="o">=</span><span class="mf">514.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF_trigger</span><span class="o">==</span><span class="mf">514.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mf">514.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">postLoadCounter</span><span class="o">==</span><span class="mi">11</span><span class="p">)</span>
<div class="viewcode-block" id="TestPyDerived.testPickle"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testPickle">[docs]</a>    <span class="k">def</span> <span class="nf">testPickle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: deepcopy&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aNode</span><span class="o">.</span><span class="n">pos</span><span class="o">==</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF</span><span class="o">=</span><span class="mf">2.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aNode</span><span class="o">.</span><span class="n">pos</span><span class="o">=</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mf">2.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aNode</span><span class="o">.</span><span class="n">pos</span><span class="o">==</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="c1"># pickle needs the class to be found in the module itself</span>
        <span class="c1">#    PicklingError: Can&#39;t pickle &lt;class &#39;woo.tests.core._TestPyClass&#39;&gt;: it&#39;s not found as woo.tests.core._TestPyClass</span>
        <span class="c1"># this is fixed now the class is defined at the module level</span>
        <span class="n">t2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mf">2.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">aNode</span><span class="o">.</span><span class="n">pos</span><span class="o">==</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF</span><span class="o">=</span><span class="mf">0.</span>
        <span class="n">t3</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">aF</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span> <span class="c1"># with kw arg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t3</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mf">1.</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mf">0.</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestPyDerived.testTypeCoerceFloats"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testTypeCoerceFloats">[docs]</a>    <span class="k">def</span> <span class="nf">testTypeCoerceFloats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: type coercion (primitive types)&#39;</span>
        <span class="c1"># numbers and number sequences            </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span><span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;aF&#39;</span><span class="p">,</span><span class="s1">&#39;asd&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span><span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;aF&#39;</span><span class="p">,</span><span class="s1">&#39;123&#39;</span><span class="p">))</span> <span class="c1"># disallow conversion from strings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span><span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;aFF&#39;</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;ab&#39;</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span><span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;aFF&#39;</span><span class="p">,</span><span class="s1">&#39;ab&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span><span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;aFF&#39;</span><span class="p">,[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)]))</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aFF</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Empty list not accepter for list of floats&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aFF</span><span class="o">=</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Vector3 not accepted for list of floats&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aV2</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;2-tuple not accepted for Vector2&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestPyDerived.testTypeCoerceObject"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testTypeCoerceObject">[docs]</a>    <span class="k">def</span> <span class="nf">testTypeCoerceObject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: type coercion (woo.core.Object)&#39;</span>
        <span class="c1"># c++ objects</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aNode</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;None not accepted as woo.core.Node&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span><span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;aNode&#39;</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">()))</span>
        <span class="c1"># list of c++ objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span><span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;aNNode&#39;</span><span class="p">,(</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">(),</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Scene</span><span class="p">())))</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aNNode</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="n">woo</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Node</span><span class="p">()]</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;[None,Node] not accepted for list of Nodes&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestPyDerived.testTypeCoerceCtor"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testTypeCoerceCtor">[docs]</a>    <span class="k">def</span> <span class="nf">testTypeCoerceCtor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: type coercion (ctor)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span><span class="n">_TestPyClass</span><span class="p">(</span><span class="n">aF</span><span class="o">=</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestPyDerived.testTraits"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testTraits">[docs]</a>    <span class="k">def</span> <span class="nf">testTraits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: PyAttrTraits&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">_attrTraits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ini</span><span class="o">==</span><span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">_attrTraits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pyType</span><span class="o">==</span><span class="nb">float</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestPyDerived.testIniDefault"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testIniDefault">[docs]</a>    <span class="k">def</span> <span class="nf">testIniDefault</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: default initialization&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mf">1.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aFF</span><span class="o">==</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">2.</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">aNodeNone</span><span class="o">==</span><span class="kc">None</span><span class="p">)</span></div>
    <span class="k">def</span> <span class="nf">testIniUser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: user initialization&#39;</span>
        <span class="n">t2</span><span class="o">=</span><span class="n">_TestPyClass</span><span class="p">(</span><span class="n">aF</span><span class="o">=</span><span class="mf">2.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mf">2.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AttributeError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="n">_TestPyClass</span><span class="p">(</span><span class="n">nonsense</span><span class="o">=</span><span class="mi">123</span><span class="p">))</span>
<div class="viewcode-block" id="TestPyDerived.testStrValidation"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testStrValidation">[docs]</a>    <span class="k">def</span> <span class="nf">testStrValidation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: string choice is validated&#39;</span>
        <span class="k">try</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">sChoice</span><span class="o">=</span><span class="s1">&#39;bb&#39;</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Valid choice value not accepted as new attribute value&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;sChoice&#39;</span><span class="p">,</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">_TestPyClass</span><span class="p">(</span><span class="n">sChoice</span><span class="o">=</span><span class="s1">&#39;abc&#39;</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">_TestPyClass</span><span class="p">(</span><span class="n">sChoice</span><span class="o">=</span><span class="s1">&#39;bb&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span><span class="s2">&quot;Valid choice value not accepted in ctor&quot;</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestPyDerived.testBoostSaveError"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testBoostSaveError">[docs]</a>    <span class="k">def</span> <span class="nf">testBoostSaveError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: refuses to save via Object::save (data loss; dump must be used instead)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IOError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;whatever&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IOError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;whatever&#39;</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestPyDerived.testBoostDumpError"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testBoostDumpError">[docs]</a>    <span class="k">def</span> <span class="nf">testBoostDumpError</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: refuses to dump with boost::serialization format (data loss)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IOError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;whatever.xml&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">IOError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s1">&#39;whatever.xml&#39;</span><span class="p">))</span></div>
<div class="viewcode-block" id="TestPyDerived.testDeprecated"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testDeprecated">[docs]</a>    <span class="k">def</span> <span class="nf">testDeprecated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: deprecated attribute raises ValueError on access&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;deprecAttr&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">,</span><span class="s1">&#39;deprecAttr&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span></div>

<div class="viewcode-block" id="TestPyDerived.testPickle2"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testPickle2">[docs]</a>    <span class="k">def</span> <span class="nf">testPickle2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: deepcopy (python parent)&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">f2</span><span class="o">=</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">aF</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">tt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tt</span><span class="o">.</span><span class="n">f2</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestPyDerived.testIniUser"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testIniUser">[docs]</a>    <span class="k">def</span> <span class="nf">testIniUser</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: user initialization (python parent)&#39;</span>
        <span class="n">t2</span><span class="o">=</span><span class="n">_TestPyClass2</span><span class="p">(</span><span class="n">aF</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">f2</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">aF</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">t2</span><span class="o">.</span><span class="n">f2</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span></div>
<div class="viewcode-block" id="TestPyDerived.testTrigger"><a class="viewcode-back" href="../../../woo.tests.html#woo.tests.test_core.TestPyDerived.testTrigger">[docs]</a>    <span class="k">def</span> <span class="nf">testTrigger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;PyDerived: postLoad trigger (python parent)&#39;</span>
        <span class="n">c1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">postLoadCounter</span>
        <span class="n">c2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">f2counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">f2</span><span class="o">=</span><span class="mf">4.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">aF_trigger</span><span class="o">=</span><span class="mf">5.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">f2counter</span><span class="o">&gt;</span><span class="n">c2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">postLoadCounter</span><span class="o">&gt;</span><span class="n">c1</span><span class="p">)</span></div></div>


        
    

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">Woo 1.0+rev1-git-f169989 documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../tests.html" >woo.tests</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">woo.tests.test_core</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2012−2022, Václav Šmilauer &lt;eu@doxos.eu&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>



<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Flow analysis &#8212; Woo 1.0+rev1-git-3898baf documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/cloud.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    
    
     
        <script src="../_static/jquery.cookie.js"></script>
    

    
     
        <script src="../_static/cloud.base.js"></script>
    

    
     
        <script src="../_static/cloud.js"></script>
    

    <link rel="shortcut icon" href="../_static/woo-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Clumps" href="clump.html" />
    <link rel="prev" title="Visualization" href="visualization.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="clump.html" title="Clumps"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="visualization.html" title="Visualization"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Woo 1.0+rev1-git-3898baf documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">User’s manual</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Flow analysis</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="flow-analysis">
<span id="user-manual-flow-analysis"></span><h1>Flow analysis<a class="headerlink" href="#flow-analysis" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference internal" href="../woo.dem.html#woo.dem.FlowAnalysis" title="woo.dem.FlowAnalysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.dem.FlowAnalysis</span></code></a> engine is used to periodically collect particle data on a given <a class="reference internal" href="../woo.dem.html#woo.dem.FlowAnalysis.box" title="woo.dem.FlowAnalysis.box"><code class="xref py py-obj docutils literal notranslate"><span class="pre">box</span></code></a>, using uniform grid with <a class="reference external" href="http://en.wikipedia.org/wiki/Trilinear_interpolation">trilinear interpolation</a> to save values. The <a class="reference internal" href="../woo.dem.html#woo.dem.FlowAnalysis.dLim" title="woo.dem.FlowAnalysis.dLim"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dLim</span></code></a> parameter serves to define fraction limits, as fractions are observed separately.</p>
<p>This <a class="reference internal" href="../woo.pre.html#woo.pre.horse.FallingHorse" title="woo.pre.horse.FallingHorse"><code class="xref py py-obj docutils literal notranslate"><span class="pre">basic</span> <span class="pre">example</span></code></a> shows flow rate (computed after the simulation) rendered as volume cloud in Paraview, along with particles and meshes being visible; in addition, <a class="reference external" href="http://paraview.org/OnlineHelpCurrent/StreamTracer.html">StreamTracer</a> is used to integrate the flow field and render it as lines.</p>
<iframe src="https://www.youtube.com/embed/LB3T6sBdwz0" style="border: 0; height: 345px; width: 560px">
</iframe><p>Each grid cell is cube-shaped with <span class="math notranslate nohighlight">\(V=h\times h\times h\)</span>; the data cumulated in each grid point are</p>
<ul class="simple">
<li><p>flow vector computed from <span class="math notranslate nohighlight">\(\vec{v}m/V\)</span> (momentum per volume, unit-wise giving <span class="math notranslate nohighlight">\(\mathrm{kg(m/s)/(m^3)=(kg/m^2)/s}\)</span>);</p></li>
<li><p>kinetic energy density <span class="math notranslate nohighlight">\(E_k/(V)\)</span>;</p></li>
<li><p>hit count <span class="math notranslate nohighlight">\(1/(V)\)</span>;</p></li>
</ul>
<p>where each value is multiplied by its weight <span class="math notranslate nohighlight">\(w\)</span> respective to the grid interpolation point:</p>
<ol class="arabic">
<li><p>determine indices <span class="math notranslate nohighlight">\((i,j,k)\)</span> defining the grid cell <span class="math notranslate nohighlight">\(\{i,i+1\}\times\{j,j+1\}\times\{k,k+1\}\)</span> in which the point in question is contained.</p></li>
<li><p>compute cell-normalized coordinates <span class="math notranslate nohighlight">\(\hat{x}=\frac{x-x_i}{h}\)</span>, <span class="math notranslate nohighlight">\(\hat{y}=\frac{y-y_j}{h}\)</span>, <span class="math notranslate nohighlight">\(\hat{z}=\frac{z-z_k}{h}\)</span>.</p></li>
<li><p>There are 8 cell corners:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 25%" />
<col style="width: 49%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>grid indices</p></td>
<td><p>normalized coordinate</p></td>
<td><p>point weight <span class="math notranslate nohighlight">\(w_i\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\((i,j,k)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((0,0,0)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((1-\hat{x})(1-\hat{y})(1-\hat{z})\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\((i+1,j,k)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((1,0,0)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{x}(1-\hat{y})(1-\hat{z})\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\((i+1,j+1,k)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((1,1,0)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{x}\hat{y}(1-\hat{z})\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\((i,j+1,k)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((0,1,0)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((1-\hat{x})\hat{y}(1-\hat{z})\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\((i,j,k+1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((0,0,1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((1-\hat{x})(1-\hat{y})\hat{z}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\((i+1,j,k+1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((1,0,1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{x}(1-\hat{y})\hat{z}\)</span></p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\((i+1,j+1,k+1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((1,1,1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\hat{x}\hat{y}\hat{z}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\((i,j+1,k+1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((0,1,1)\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\((1-\hat{x})\hat{y}\hat{z}\)</span></p></td>
</tr>
</tbody>
</table>
<p>which are assigned values using their respective weight <span class="math notranslate nohighlight">\(w_i\)</span>. It can be verified that the sum of all <span class="math notranslate nohighlight">\(w_i\)</span> is one, i.e. that the interpolation is a partition of unity.</p>
</li>
</ol>
<p>All quantities are finally averaged over the entire <a class="reference internal" href="../woo.dem.html#woo.dem.FlowAnalysis.timeSpan" title="woo.dem.FlowAnalysis.timeSpan"><code class="xref py py-obj docutils literal notranslate"><span class="pre">time</span> <span class="pre">span</span></code></a> that the <a class="reference internal" href="../woo.dem.html#woo.dem.FlowAnalysis" title="woo.dem.FlowAnalysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FlowAnalysis</span></code></a> engine covers.</p>
<section id="fraction-separation">
<h2>Fraction separation<a class="headerlink" href="#fraction-separation" title="Permalink to this headline">¶</a></h2>
<p>Using the <a class="reference internal" href="../woo.dem.html#woo.dem.FlowAnalysis.dLim" title="woo.dem.FlowAnalysis.dLim"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dLim</span></code></a>, fractions to be analyzed separately can be defined; we name those fields <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> in the following. Fraction behavior can be inspected visually, but analysis functions harness the computer power to show relevant data only (see the documentation of <a class="reference internal" href="../woo.dem.html#woo.dem.FlowAnalysis" title="woo.dem.FlowAnalysis"><code class="xref py py-obj docutils literal notranslate"><span class="pre">woo.dem.FlowAnalysis</span></code></a> for the reference). Some of the available functions are:</p>
<ol class="arabic">
<li><p>Cross-product (called <code class="docutils literal notranslate"><span class="pre">cross</span></code> in the VTK files), showing rotation of one vector field with respect to another, computed simply as <span class="math notranslate nohighlight">\(A\times B\)</span>.</p></li>
<li><p>Flow difference (<code class="docutils literal notranslate"><span class="pre">diff</span></code>), showing <span class="math notranslate nohighlight">\(\delta_{\alpha}=A-\alpha B\)</span>, where <span class="math notranslate nohighlight">\(\alpha=\bar{A}{\bar{B}}\)</span> (<span class="math notranslate nohighlight">\(\bar{\bullet}\)</span> denotes global average norm value) making the fraction flow directly comparable.</p></li>
<li><p>Signed flow differences for both fractions (<code class="docutils literal notranslate"><span class="pre">diffA</span></code>, <code class="docutils literal notranslate"><span class="pre">diffB</span></code>) defined as</p>
<div class="math notranslate nohighlight">
\begin{align*}
   \delta_{\alpha}^A&amp;=\begin{cases}\delta_{\alpha} &amp; \hbox{if }\delta_{\alpha}\cdot(A+B)&gt;0 \\ \vec{0} &amp; \hbox{otherwise}\end{cases} \\
   \delta_{\alpha}^B&amp;=\begin{cases} \vec{0} &amp; \hbox{if }\delta_{\alpha}\cdot(A+B)&gt;0 \\ \delta_{\alpha} &amp; \hbox{otherwise}\end{cases} \\
 \end{align*}</div></li>
</ol>
<p>In the following example, we are examining segregation in a chute. We export fractions for Paraview separately and apply the Glyph filter to both of them. Disable the <span class="guilabel">Mask points</span> option, adjust the <span class="guilabel">Set Scale Factor</span> if necessary. Set <span class="menuselection">Coloring ‣ Solid Color</span> and then <span class="menuselection">Coloring ‣ Edit</span> to set color for each fraction differently:</p>
<img alt="../_images/flow-paraview-vector-field.png" src="../_images/flow-paraview-vector-field.png" />
<p>In our example, we obtain the following two flow fields, separately for small (green) and big (red) fractions.</p>
<a class="reference internal image-reference" href="../_images/flow-two-fields.png"><img alt="../_images/flow-two-fields.png" src="../_images/flow-two-fields.png" style="width: 100%;" /></a>
<p>In the middle of this image, the big (red) fraction is going more towards the right while the small (green) fraction sinks – this show that segregation is taking place in this region. Segregation can be visualized by computing <a class="reference external" href="http://en.wikipedia.org/wiki/Cross_product">vector product</a> of both fractions; the vectors now indicate rotation of the big (red) fraction flow with respect to the small (green) fraction flow; following the right-hand rule, if you align the right thumb with the arrow, the fingers will show how is the big (red) fraction deviating from the small (green) one (the stream lines were added for visual clarity):</p>
<a class="reference internal image-reference" href="../_images/flow-cross.png"><img alt="../_images/flow-cross.png" src="../_images/flow-cross.png" style="width: 100%;" /></a>
<p>This can be visualized along with the flow fields (the region we were analyzing is now at the bottom of the image, and another strong segregation region is on the top):</p>
<a class="reference internal image-reference" href="../_images/flow-cross-bigger.png"><img alt="../_images/flow-cross-bigger.png" src="../_images/flow-cross-bigger.png" style="width: 100%;" /></a>
<p>We visualize signed flow difference fields (again using different solid color for each of them); the red field shows were there is prevalent flow of the big fraction (without corresponding flow of the small fraction) and vice versa. The image therefore reveals that the deposition of particles at the bottom is irregular, since the small fraction falls down first (on the left).</p>
<a class="reference internal image-reference" href="../_images/flow-signed-diff.png"><img alt="../_images/flow-signed-diff.png" src="../_images/flow-signed-diff.png" style="width: 100%;" /></a>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Report issues or inclarities to <a class="reference external" href="https://github.com/woodem/woo/issues">github</a>.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="sphinx-toc sphinxlocaltoc">
    <h3><a href="../contents.html">Page contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Flow analysis</a><ul>
<li><a class="reference internal" href="#fraction-separation">Fraction separation</a></li>
</ul>
</li>
</ul>

  </div>
  <div class="sphinxprev">
    <h4>Previous page</h4>
    <p class="topless"><a href="visualization.html"
                          title="Previous page">&larr; Visualization</a></p>
  </div>
  <div class="sphinxnext">
    <h4>Next page</h4>
    <p class="topless"><a href="clump.html"
                          title="Next page">&rarr; Clumps</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user/flow-analysis.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="clump.html" title="Clumps"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="visualization.html" title="Visualization"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="../index.html">Woo 1.0+rev1-git-3898baf documentation</a> &#187;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >User’s manual</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Flow analysis</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2012−2022, Václav Šmilauer &lt;eu@doxos.eu&gt;.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>